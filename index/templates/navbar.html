<a class="navbar-brand home" href="{% url 'home' %}">dopepod</a>
<button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
  <span class="navbar-toggler-icon"></span>
</button>

<div class="collapse navbar-collapse" id="navbarSupportedContent">
  <ul class="navbar-nav mr-auto">
    <li class="nav-item">
      <a class="nav-link" href="#">blog</a>
    </li>
    {% if user.is_authenticated %}
    <li class="nav-item">
      <a class="nav-link settings" href="{% url 'edit_profile' %}" data-toggle="modal" data-target="#modal">settings</a>
    </li>
    <li class="nav-item">
      <a class="nav-link subscriptions" href="{% url 'subscriptions' %}">subscriptions</a>
    </li>
    <li class="nav-item">
      <a class="nav-link browse" href="{% url 'browse' %}">browse</a>
    </li>
    {% endif %}
  </ul>
</div>
<ul class="navbar-nav ml-auto">
  {% if user.is_authenticated %}
  <li>
    <a class="btn btn-primary ajax-logout" href="{% url 'account_logout' %}">
      Logout {{ user.username }}
    </a>
  </li>
  {% else %}
  <li>
    <a class="btn btn-primary ajax-register" href="{% url 'account_signup' %}" data-toggle="modal" data-target="#modal">
      Register
    </a>
  </li>
  <li>
    <a class="btn btn-primary ajax-login" href="{% url 'account_login' %}" data-toggle="modal" data-target="#modal">
      Login
    </a>
  </li>
  {% endif %}
</ul>
<!-- <form class="form-inline my-2 my-lg-0">
  <input class="form-control mr-sm-2" type="search" placeholder="Search" aria-label="Search">
  <button class="btn btn-outline-success my-2 my-sm-0" type="submit">Search</button>
</form> -->

<script type="text/javascript">
$(function() {
  // mousedown?
  $('.ajax-login, .ajax-register').click(function(e) {
    e.preventDefault();
    var url = this.href;
    var method = this.method;
    $.ajax({
      type: method,
      url: url,
      error: function(xhr, ajaxOptions, thrownError){
        console.log(thrownError);
      },
      success: function(response) {
        $(".modal-content").html(response.html);
      }
    });
  });
  $('.ajax-logout').click(function(e) {
    e.preventDefault();
    $.ajax({
      type: "GET",
      url: "{% url 'account_logout' %}",
      error: function(xhr, ajaxOptions, thrownError){
        console.log(thrownError);
      },
      success: function() {
        var csrftoken = "{{ csrf_token }}";
        refresh_page(csrftoken);
      }
    });
  });
  $('.home').click(function(e) {
    e.preventDefault();
    var url = "{% url 'home' %}";
    var csrftoken = "{{ csrf_token }}";
    $.ajax({
      type: "POST",
      url: url,
      data: {
        "csrfmiddlewaretoken": csrftoken,
      },
      error: function(xhr, ajaxOptions, thrownError){
        console.log(thrownError);
      },
      success: function(response) {
        var title = "dopepod";
        var state = {
          "context": response,
          "title": title,
        };
        history.pushState(state, "", url);
        $(".site-content").hide();
        $(".site-content").html(response);
        $(".site-content").fadeIn();
        $("title")[0].innerText = title;
      }
    });
  });
  $('.settings').click(function(e) {
    e.preventDefault();
    var url = "{% url 'edit_profile' %}";
    $.ajax({
      type: "GET",
      url: url,
      error: function(xhr, ajaxOptions, thrownError){
        console.log(thrownError);
      },
      success: function(response) {
        $(".modal-content").html(response);
      }
    });
  })
  $('.subscriptions').click(function(e) {
    e.preventDefault();
    var url = "{% url 'subscriptions' %}";
    var csrftoken = "{{ csrf_token }}";
    $.ajax({
      type: "POST",
      url: url,
      data: {
        "csrfmiddlewaretoken": csrftoken,
      },
      error: function(xhr, ajaxOptions, thrownError){
        console.log(thrownError);
      },
      success: function(response) {
        var title = "subscriptions";
        var state = {
          "context": response,
          "title": title,
        };
        history.pushState(state, "", url);
        $(".site-content").hide();
        $(".site-content").html(response);
        $(".site-content").fadeIn();
        $("title")[0].innerText = title;
      }
    });
  });
  $('.browse').click(function(e) {
    e.preventDefault();
    var url = "{% url 'browse' %}";
    var csrftoken = "{{ csrf_token }}";
    $.ajax({
      type: "POST",
      url: url,
      data: {
        "ajax": "yep",
        "csrfmiddlewaretoken": csrftoken,
      },
      error: function(xhr, ajaxOptions, thrownError){
        console.log(thrownError);
      },
      success: function(response) {
        var title = "browse";
        var state = {
          "context": response,
          "title": title,
        };
        history.pushState(state, "", url);
        $(".site-content").hide();
        $(".site-content").html(response);
        $(".site-content").fadeIn();
        $("title")[0].innerText = title;
      }
    });
  });
  $(window).on('popstate', function(event) {
    var state = event.originalEvent.state;
    if (state) {
      $(".site-content").hide();
      $(".site-content").html(state.context);
      $(".site-content").fadeIn();
      $("title")[0].innerText = state.title;
      if (state.q) {
        $("#q").val(state.q);
      }
    }
  });
});
</script>

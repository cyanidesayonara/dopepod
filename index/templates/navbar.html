

<a class="navbar-brand" href="{% url 'home' %}">dopepod</a>
<ul class="navbar-nav mr-auto">
  <li class="nav-item">
    <a class="nav-link" href="#">blog</a>
  </li>
  {% if user.is_authenticated %}
  <li class="nav-item">
    <a class="nav-link" href="{% url 'edit_profile' %}">settings</a>
  </li>
  <li class="nav-item">
    <a class="nav-link subscriptions" type="GET" href="{% url 'subscriptions' %}">subscriptions</a>
  </li>
  {% endif %}
</ul>
<ul class="navbar-nav ml-auto">
  {% if user.is_authenticated %}
  <li>
    <a class="btn btn-primary ajax-logout" href="{% url 'account_logout' %}">
      logout
    </a>
  </li>
  {% else %}
  <li>
    <a class="btn btn-primary ajax-register" href="{% url 'account_signup' %}" data-toggle="modal" data-target="#modal">
      register
    </a>
  </li>
  <li>
    <a class="btn btn-primary ajax-login" href="{% url 'account_login' %}" data-toggle="modal" data-target="#modal">
      login
    </a>
  </li>
  {% endif %}
</ul>
<form class="form-inline my-2 my-lg-0">
  <input class="form-control mr-sm-2" type="search" placeholder="Search" aria-label="Search">
  <button class="btn btn-outline-success my-2 my-sm-0" type="submit">Search</button>
</form>

<script type="text/javascript">
$(function() {
  function refresh_page() {
    // refresh navbar (and maybe other stuff as well?)
    $.ajax({
      type: "GET",
      url: "{% url 'navbar' %}",
      error: function(xhr, ajaxOptions, thrownError){alert(thrownError);},
      success: function(response) {
        // refresh navbar
        $(".nav-content").html(response);
        // TODO go to index
      }
    });
  }
  // mousedown?
  $('.ajax-login, .ajax-register').click(function(e) {
    e.preventDefault();
    var url = this.href;
    var method = this.method;
    $.ajax({
      type: method,
      url: url,
      error: function(xhr, ajaxOptions, thrownError){alert(thrownError);},
      success: function(response) {
        $(".modal-content").html(response.html);
      }
    });
  });
  $('.ajax-logout').click(function(e) {
    e.preventDefault();
    $.ajax({
      type: "GET",
      url: "{% url 'account_logout' %}",
      error: function(xhr, ajaxOptions, thrownError){alert(thrownError);},
      success: function() {
        refresh_page();
      }
    });
  });
  $('.subscriptions').click(function(e) {
    e.preventDefault();
    var url = "{% url 'ajax_subscriptions' %}";
    $.ajax({
      type: "GET",
      url: url,
      error: function(xhr, ajaxOptions, thrownError){alert(thrownError);},
      success: function(response) {
        // TODO hide searchbar?
        $("#results").html(response);
      }
    });
  });
});
</script>

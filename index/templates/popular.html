{% load cache %}

{% cache 86400 popular %}
  <div class="row">
    <div class="col-12 results-bar color-4">
      <h1>
        Most popular by 
        <span>
          genre
        </span>
        <span class="d-none">
          language
        </span>
      </h1>
    </div>
  </div>
  <div class="row">
    <div class="col-12 color-3 dope-options">
      <div class="dope-buttons dope-buttons-r">
        <button class="btn-dope popular-button">
          <span class="active">
            Show
          </span>
          <span class="btn-dope-toggle">
            <span>
              Genre
            </span>
            <span class="d-none">
              Language
            </span>
          </span>
        </button>
      </div>
    </div>
  </div>
  <div class="row">
    {% with results.genres as genres %}
      <div class="col-12 px-0 collapse popular-collapse fade show" id="genre-collapse-{{ results.view }}">
        <div class="popular-carousel">
          {% for genre in genres %}
            <div>
              <a class="slick-link color-1 browse-link" href="/search/?genre={{ genre.genre.url_format }}&view=grid">
                <h1>
                  {{ genre.genre }}
                </h1>
              </a>
              <div class="dope-results">
                {% for podcast in genre.podcasts %}
                  <div class="col-4 col-lg-2 dope-result">
                    <a class="showpod-link" data-podid="{{ podcast.podid }}" href="{% url 'showpod' podid=podcast.podid %}">
                      <img class="img-fluid" data-lazy="//{{ podcast.artworkUrl }}200x200bb.jpg" onerror="this.src='//dopepod.me/img/{{ podcast.artworkUrl }}200x200bb.jpg'" width="auto" height="auto" />
                      <h1>
                        {{ podcast.title }}
                      </h1>
                      <h2>
                        <span class="by">
                          by
                        </span>
                        {{ podcast.artist }}
                      </h2>
                    </a>
                  </div>
                {% endfor %}
              </div>
              <a class="slick-link color-1 browse-link" href="/search/?genre={{ genre.genre.url_format }}&view=grid">
                <p>
                  See {% if genre.genre.n_podcasts > 1 %} all {% endif %} {{ genre.genre.n_podcasts }} podcast{{ genre.genre.n_podcasts|pluralize }}
                </p>
              </a>
            </div>
          {% endfor %}      
        </div>
      </div>
    {% endwith%}
    {% with results.languages as languages %}
      <div class="col-12 px-0 collapse popular-collapse fade" id="language-collapse-{{ results.view }}">
        <div class="popular-carousel">
          {% for language in languages %}
          <div>
            <a class="slick-link color-1 browse-link" href="/search/?language={{ language.language.url_format }}&view=grid">
              <h1>
                {{ language.language }}
              </h1>
            </a>
            <div class="dope-results">
              {% for podcast in language.podcasts %}
              <div class="col-4 col-lg-2 dope-result">
                <a class="showpod-link" data-podid="{{ podcast.podid }}" href="{% url 'showpod' podid=podcast.podid %}">
                  <img class="img-fluid" data-lazy="//{{ podcast.artworkUrl }}200x200bb.jpg" onerror="this.src='//dopepod.me/img/{{ podcast.artworkUrl }}200x200bb.jpg'"
                    width="auto" height="auto" />
                  <h1>
                    {{ podcast.title }}
                  </h1>
                  <h2>
                    <span class="by">
                      by
                    </span>
                    {{ podcast.artist }}
                  </h2>
                </a>
              </div>
              {% endfor %}
            </div>
            <a class="slick-link color-1 browse-link" href="/search/?language={{ language.language.url_format }}&view=grid">
              <p>
                See {% if language.language.n_podcasts > 1 %} all {% endif %} {{ language.language.n_podcasts }} podcast{{
                language.language.n_podcasts|pluralize }}
              </p>
            </a>
          </div>
          {% endfor %}
        </div>
      </div>
    {% endwith%}
  </div>
{% endcache %}

"use strict";function pushState(e){for(var t=["episodes","dopebar","charts","last-played","change-password"],o=0;o<t.length;o++)if(e.includes(t[o]))return;updateTitle();var s=$("#main"),l=s[0].innerHTML,n={context:l,url:e};history.pushState(n,"",e)}function replaceState(e){e=e.replace("episodes","showpod");for(var t=["dopebar","charts","last-played","change-password"],o=0;o<t.length;o++)if(e.includes(t[o]))return;var s=$("#main");e&&!e.includes("unsubscribe")||(e=s[0].baseURI),updateTitle();var l=s[0].innerHTML,n={context:l,url:e};history.replaceState(n,"",e)}function updateTitle(){var e="dopepod",t=$("#player-wrapper"),o=$("#center-stage .results-header h1");if(t.length){e=t.find("h1")[0].innerText;var s=t.find(".player-episode")[0].innerText;e="Now playing: "+e+" - "+s+" | dopepod"}else o.length&&(e=$("#center-stage").children().hasClass("showpod")?"Listen to episodes of "+o[0].innerText+" | dopepod":o[0].innerText+" | dopepod");$("title")[0].innerText=e}function getCookie(e){var t=null;if(document.cookie&&""!==document.cookie)for(var o=document.cookie.split(";"),s=0;s<o.length;s++){var l=jQuery.trim(o[s]);if(l.substring(0,e.length+1)===e+"="){t=decodeURIComponent(l.substring(e.length+1));break}}return t}function csrfSafeMethod(e){return/^(GET|HEAD|OPTIONS|TRACE)$/.test(e)}function refreshCookie(){var e=getCookie("csrftoken");$.ajaxSetup({beforeSend:function(t,o){csrfSafeMethod(o.type)||this.crossDomain||t.setRequestHeader("X-CSRFToken",e)}})}function refreshPage(){var e=!1;getResults(["/dopebar/","#dopebar",e]),getResults(["/last-played/","#last-played",e])}function checkForXHR(e){if(null!=xhr){for(var t=["dopebar","charts","episodes","last-played"],o=0;o<t.length;o++)if(e.includes(t[o]))return;xhr.abort(),xhr=null}}function getResults(e,t){var o=e[0],s=$(e[1]),l=e[2],n=e[3],e=e[4];checkForXHR(o),t||pushState(o),xhr=$.ajax({type:"GET",url:o}).fail(function(e,t,s){o.includes("/episodes/")?(podid=o.split("/")[2],podid&&noshow(podid)):(o.includes("last-played")||o.includes("charts"))&&(window.clearInterval(charts),window.clearInterval(last_played))}).done(function(t){if(s.html(t),n)n(e);else if(s.is("#dopebar")){var t=s.children(),l=t.data("theme");t.removeData("theme"),t.removeAttr("data-theme"),changeTheme(l)}replaceState(o)}),s.children(".loading").length||"/dopebar/"==o||"/last-played/"==o||(s.children(".results").length?s.children(".results").addClass("loading").html(getCircleLoading()):s.find(".episodes-content").html(getCircleLoading())),l&&scrollTo(s)}function noshow(e){$.ajax({data:{podid:e},method:"POST",url:"/noshow/"})}function scrollSpy(){$(window).scroll(function(){scrollUp(),footer()})}function scrollUp(){var e=$(window).scrollTop();e>300?$(".scroll-up").addClass("d-sm-block"):$(".scroll-up").removeClass("d-sm-block")}function scrollToTop(){$("html, body").animate({scrollTop:$("body").offset().top},250)}function scrollTo(e){$("html, body").animate({scrollTop:e.offset().top-44},250)}function scrollText(e,t){var o=e.innerWidth(),s=t.width();if(s>o){var l=30*s;$(e).animate({scrollLeft:s-o},l).animate({scrollLeft:0},l,function(){setTimeout(function(){scrollText(e,t)},1e3)})}}function footer(){var e=$("#footer").offset().top,t=$(window).scrollTop()+$(window).height();e>t?$("#player").addClass("fixed-bottom"):$("#player").removeClass("fixed-bottom")}function changeTheme(e){for(var t=["light","dark","christmas"],o=0;o<t.length;o++)e.includes(t[o])&&$("body").removeClass().addClass(e)}function postSettings(e){var t=e.method,o=e.action,e=$(e),s=e.serialize(),l=e.find("input[name=theme]").val(),n=$("#center-stage");$.ajax({data:s,method:t,url:o}).fail(function(e,t,o){$("#center-stage").html(e.responseText),scrollToTop()}).done(function(e){l&&changeTheme(l),n.html(e),scrollToTop(),replaceState(o)}),n.children(".results").addClass("loading").html(getCircleLoading())}function postLogin(e){var t=e.method,o=e.action,e=$(e),s=e.serialize(),l=e.find("button[type=submit]"),n=l[0].innerText;l.html(getButtonLoading()),$.ajax({data:s,method:t,url:o}).fail(function(e,t,o){$("#center-stage").html(e.responseText),scrollToTop()}).done(function(e){$("#center-stage").html(e),"Login"===n&&(refreshCookie(),refreshPage()),scrollToTop()})}function postSubscriptions(e,t){clearTimeout(timeout),timeout=setTimeout(function(){$.ajax({method:"POST",url:"/subscriptions/",data:{podids:e}}).fail(function(e,t,o){$("#center-stage").html(e.responseText),replaceState("/")}).done(function(t){if($("#center-stage").html(t),$(t).hasClass("showpod")){var o="/episodes/"+e+"/",s=".showpod .results-content",l=!1;getResults([o,s,l])}}),t.html(getButtonLoading())},250)}function postPlaylist(e,t,o){var s=$("#center-stage"),l=o[0].innerHTML,n="/playlist/";$.ajax({method:"POST",url:n,data:e}).fail(function(e,t,s){o.html(l),$("#player").empty()}).done(function(e){if("play"==t){if($("#player").html(e),updateTitle(),o.html(l),setTimeout(function(){var e=$("#player-wrapper h1"),t=$("#player-wrapper h1 span");scrollText(e,t)},1e3),s.children(".playlist").length){var a=!1;getResults([n,s,a])}}else"add"==t&&o.text(l),s.children(".playlist").length&&s.html(e)}),o.is("#player-wrapper")?o.html(getCircleLoading()):o.html(getButtonLoading())}function playNext(){var e={pos:"1",mode:"play"},t="play",o=$("#player-wrapper");o.children("audio")[0].preload="none",o.empty(),timeout=setTimeout(function(){postPlaylist(e,t,o)},500)}function closePlayer(){var e=$("#player");e.find("audio")[0].preload="none",e.empty(),updateTitle()}function cleanString(e){return e=e.replace(/&+/g,"+"),e=e.replace(/\s+/g,"+"),e=e.replace(/([^a-zA-Z0-9\u0080-\uFFFF +']+)/gi,""),e.toLowerCase()}function cookieBannerClose(){$("#player").empty()}function getButtonLoading(){return $(".button-loading").first().clone()}function getCircleLoading(){return $(".circle-loading").first().clone()}function updateLastPlayed(){last_played=setInterval(function(){var e=!1;getResults(["/last-played/","#last-played",e])},6e4)}function updateCharts(){charts=setInterval(function(){var e=!1;getResults(["/charts/","#charts",e])},864e5)}var xhr=null,timeout=0,last_played=0,charts=0;$(document).ready(function(){refreshCookie(),scrollUp(),footer(),scrollToTop(),scrollSpy(),updateLastPlayed(),updateCharts()}).on("keyup submit",".search-form",function(e){e.preventDefault();var t=this.action,o=$(this);clearTimeout(timeout),timeout=setTimeout(function(){var e=o.children(".q").val();if(e&&(e=cleanString(e),s.children(".results").data("q")!=e)){var s=$("#center-stage");t=t+"?q="+e;var l=!0;getResults([t,s,l])}},250)}).on("click",".options-button",function(e){e.preventDefault();var t=this.href,o=$(this),s=o.parents(".results").data("view");clearTimeout(timeout),timeout=setTimeout(function(){s&&(t.includes("view")?t=t.substring(0,t.indexOf("view"))+"view="+s:t+="&view="+s);var e=o.parents(".results").parent(),l=!0;getResults([t,e,l])},250)}).on("click",".showpod .pages-buttons .options-button",function(e){e.preventDefault();var t=this.href.replace("showpod","episodes"),o=$(this);clearTimeout(timeout),timeout=setTimeout(function(){var e=o.parents(".results-content"),s=!0;getResults([t,e,s])},250)}).on("click",".showpod-link",function(e){e.preventDefault();var t=this.href,o=$(this),s=o.data("podid"),l=$("#center-stage");if(l.children(".results").data("podid")!=s){var n=!1,a=["/episodes/"+s+"/",".showpod .results-content",n];n=!0,getResults([t,l,n,getResults,a])}else l.find(".results-collapse").collapse("show"),scrollTo(l)}).on("click",".login-link, .signup-link, .password-link, .index-link, .results-close",function(e){e.preventDefault();var t=this.href,o=$("#center-stage"),s=$(this);if(o.children(".splash").length||o.children(".dashboard").length)s.hasClass("login-link")?o.find("#login-collapse").collapse("show"):s.hasClass("signup-link")?o.find("#signup-collapse").collapse("show"):s.hasClass("password-link")?o.find("#password-collapse").collapse("show"):o.find("#splash-collapse").collapse("show"),s.hasClass("collapsed")&&o.find("#splash-collapse").collapse("show"),scrollTo(o);else{var l=!0;getResults([t,o,l])}}).on("click",".browse-link",function(e){e.preventDefault();var t=this.href,o=$("#center-stage");if(o.children(".list").length)o.find(".results-collapse").collapse("show"),scrollTo(o);else{var s=!0;getResults([t,o,s])}}).on("click",".subscriptions-link",function(e){e.preventDefault();var t=this.href,o=$("#center-stage");if(o.children(".subscriptions").length)o.find(".results-collapse").collapse("show"),scrollTo(o);else{var s=!0;getResults([t,o,s])}}).on("click",".settings-link",function(e){e.preventDefault();var t=this.href,o=$("#center-stage");if(o.children(".settings").length)o.find(".results-collapse").collapse("show"),scrollTo(o);else{var s=!0;getResults([t,o,s])}}).on("click",".playlist-link",function(e){e.preventDefault();var t=this.href,o=$("#center-stage");if(o.children(".playlist").length)o.find(".results-collapse").collapse("show"),scrollTo(o);else{var s=!0;getResults([t,o,s])}}).on("click",".charts-link",function(e){e.preventDefault(),scrollTo($("#charts"))}).on("click",".last-played-link",function(e){e.preventDefault(),scrollTo($("#last-played"))}).on("click",".about-link",function(e){e.preventDefault();var t=this.href,o=$("#center-stage");if(o.children(".about").length)o.find(".results-collapse").collapse("show"),scrollTo(o);else{var s=!0;getResults([t,o,s])}}).on("submit",".subscriptions-form",function(e){e.preventDefault();var t=$(this),o=t.children("button[type=submit]"),s=t.children("input[name=podid]").val();s||(s=[],s[0]=t.children("input[name^=podids]").val()),s&&postSubscriptions(s,o)}).on("click",".unsubscribe-button",function(e){e.preventDefault();var t=$(this),o=t.parents(".results-content").find(".grid-result.selected");if(o.length){var s=[];o.each(function(e,t){s[e]=$(t).data("podid")}),s&&postSubscriptions(s,t)}}).on("submit",".playlist-form",function(e){e.preventDefault();var t=$(this);t.find(".button-loading").length||(clearTimeout(timeout),timeout=setTimeout(function(){var e=t.serialize(),o=t.children("input[name=mode]").val(),s=t.children("button[type=submit]");postPlaylist(e,o,s)},250))}).on("click",".player-close",function(e){e.preventDefault(),closePlayer()}).on("click",".player-minimize",function(e){e.preventDefault(),$("#player-collapse").collapse("hide"),$("#player-close-collapse").collapse("hide"),$(this).toggleClass("active").parents("#player-wrapper").toggleClass("minimize")}).on("click",".theme-button[type=submit]",function(e){var t=this.innerText.toLowerCase();$(this).siblings("input[name=theme]").val(t)}).on("submit",".settings-form",function(e){e.preventDefault(),postSettings(this)}).on("submit",".login-form, .signup-form, .password-form, .password-reset-form",function(e){e.preventDefault(),postLogin(this)}).on("click",".view-button",function(e){e.preventDefault();var t=$(this),o=t.children(".d-none").data("view");t.children().toggleClass("d-none"),t.parents(".results").attr("data-view",o),t.parent().parent().siblings(".view-collapse").each(function(){$(this).collapse("toggle")})}).on("mouseenter mouseleave",".view-button, .provider-button",function(){$(this).children().toggleClass("d-none")}).on("show.bs.collapse",".login-collapse",function(e){e.stopPropagation(),$(".login-collapse.show").collapse("hide")}).on("show.bs.collapse",".more-collapse",function(e){e.stopPropagation(),$(".more-collapse.show").collapse("hide");var t=$(this).parents("tr").prev();timeout=setTimeout(function(){$(window).width()<992&&scrollTo(t)},250)}).on("show.bs.collapse",".last-played-collapse",function(e){e.stopPropagation(),$(".last-played-collapse.show").collapse("hide");var t=$(this).parents();timeout=setTimeout(function(){scrollTo(t)},250)}).on("show.bs.collapse",".options-collapse",function(e){e.stopPropagation(),$(".options-collapse.show").collapse("hide")}).on("show.bs.collapse",".settings-collapse",function(e){e.stopPropagation(),$(".settings-collapse.show").collapse("hide")}).on("click",".episodes-button, .reviews-button",function(e){e.stopPropagation(),$(".showpod-collapse").collapse("toggle")}).on("click",".lights-toggle",function(e){e.preventDefault();var t=$("body").attr("class");"light"==t?t="dark":"dark"==t?t="christmas":"christmas"==t&&(t="light"),changeTheme(t)}).on("click",".btn-dope, .dopebar-link, .dope-toggle, .episode-header, .search-button",function(){$(this).blur()}).on("click","a, button",function(){$(".q").val("")}).on("click","body",function(){$(".errors").delay(2e3).fadeOut("slow",function(){$(this).remove()})}).on("click","body, .dopebar-link, .search-button",function(){$("#dopebar-collapse.show").collapse("hide")}).on("click","#dopebar",function(e){e.stopPropagation()}).on("click",".scroll-up",function(){scrollToTop()}).on("click",".select-subscription",function(){var e=$(this).parents(".grid-result").toggleClass("selected"),t=e.parents(".results").find(".grid-result"),o=e.parents(".results").find(".selected");t.length==o.length?$(".select-all-button").addClass("active"):$(".select-all-button").removeClass("active")}).on("click",".select-all-button",function(){var e=$(this);e.hasClass("active")?e.parent().parent().siblings().find(".grid-result").removeClass("selected"):e.parent().parent().siblings().find(".grid-result").addClass("selected"),e.toggleClass("active")}),$(window).on("popstate",function(e){var t=e.originalEvent.state;if(t){for(var o=t.url,s=["settings","playlist","subscriptions"],l=0;l<s.length;l++)if(o.includes(s[l])){var n=$("#center-stage"),a=!0;return void getResults([o,n,a])}$("#main").html(t.context),updateTitle()}}).on("blur",function(){window.clearInterval(charts),window.clearInterval(last_played)}).on("focus",function(){updateLastPlayed(),updateCharts()});
function pushState(e){var t=["dopebar","charts","episodes","last_played","unsubscribe"];for(i=0;i<t.length;i++)if(e.includes(t[i]))return;var o=$("#main"),s=o[0].innerHTML,l=updateTitle(),n={context:s,title:l,url:e};history.pushState(n,"",e)}function replaceState(e){var t=["dopebar","charts","last_played"];for(i=0;i<t.length;i++)if(e.includes(t[i]))return;var o=$("#main");(!e||e.includes("unsubscribe")||e.includes("episodes"))&&(e=o[0].baseURI);var s=o[0].innerHTML,l=updateTitle(),n={context:s,title:l,url:e};history.replaceState(n,"",e)}function updateTitle(){var e="dopepod",t=$(".player-wrapper");if(t.length){e=t.find(".player-title")[0].innerText;var o=t.find(".player-episode")[0].innerText;e="Now playing: "+e+" - "+o+" | on dopepod"}else $("#showpod-c").length&&(e="Listen to episodes of "+$("#showpod-c h1")[0].innerText+" on dopepod");return $("title")[0].innerText=e,e}function getCookie(e){var t=null;if(document.cookie&&""!==document.cookie)for(var o=document.cookie.split(";"),s=0;s<o.length;s++){var l=jQuery.trim(o[s]);if(l.substring(0,e.length+1)===e+"="){t=decodeURIComponent(l.substring(e.length+1));break}}return t}function csrfSafeMethod(e){return/^(GET|HEAD|OPTIONS|TRACE)$/.test(e)}function refreshCookie(){var e=getCookie("csrftoken");$.ajaxSetup({beforeSend:function(t,o){csrfSafeMethod(o.type)||this.crossDomain||t.setRequestHeader("X-CSRFToken",e)}})}function refreshPage(){var e="/dopebar/",t="#dopebar";loadResults([e,t,loadResults,["/last_played/","#last-played"]])}function checkForXHR(e){if(null!=xhr){var t=["dopebar","charts","episodes","last_played"];for(i=0;i<t.length;i++)if(e.includes(t[i]))return;xhr.abort(),xhr=null}}function loadResults(e,t){var o=e[0],s=$(e[1]),l=e[2],e=e[3];checkForXHR(o),t||pushState(o),s.find(".loading").length||"/dopebar/"==o||"/last_played/"==o||s.find(".results").replaceWith(getLoading()),xhr=$.ajax({type:"GET",url:o}).fail(function(e,t,o){}).done(function(t){s.html(t),l?(l(e),"/dopebar/"==o&&changeTheme(!$(".lights-toggle").hasClass("lit"))):$(t).hasClass("episodes-table")&&$(".episodes-button").text("Episodes"),replaceState(o)})}function scrollToTop(){$("html, body").animate({scrollTop:$("body").offset().top},250)}function scrollTo(e){$("html, body").animate({scrollTop:e.offset().top-44},250)}function scrollText(e,t){var o=e.innerWidth(),s=t.width();if(s>o+5){var l=30*s;$(e).animate({scrollLeft:s-o},l).animate({scrollLeft:0},l,function(){setTimeout(function(){scrollText(e,t)},1e3)})}}function changeTheme(e){e?$("body").addClass("darken"):$("body").removeClass("darken")}function subscribeOrUnsubscribe(e){clearTimeout(timeout),timeout=setTimeout(function(){var t=e.action,o=e.method;e=$(e);var s=e.find("input[name=podid]").val();e.find("button[type=submit]").html(getButtonLoading()),$.ajax({method:o,url:t,data:{podid:s}}).fail(function(e,t,o){$("#center-stage").html(e.responseText),replaceState("/")}).done(function(e){$("#center-stage").html(e);var t="/episodes/"+s+"/",o="#episodes-collapse";loadResults([t,o])})},250)}function yeOldePlaylistFunction(e,t,o,s){var l=s[0].innerHTML;s.html(getButtonLoading()),$.ajax({method:"POST",url:e,data:t}).fail(function(e,t,o){s.html(l),$("#player").empty()}).done(function(e){if("play"==o){var t=$("#player");t.html(e),updateTitle(),s.html(l),setTimeout(function(){var e=$(".player-title"),t=$(".player-title h1");scrollText(e,t)},1e3)}else"add"==o&&s.text(l);if($("#center-stage").find(".playlist").length){var n=$("#center-stage"),i="/playlist/";loadResults([i,n])}else if($("#center-stage").find(".dashboard").length){var n=$("#center-stage"),i="/";loadResults([i,n])}})}function playNext(){var e="/playlist/",t={pos:"0",mode:"play"},o="play",s=$(".playlist-link");yeOldePlaylistFunction(e,t,o,s)}function cleanString(e){return e=e.replace(/&+/g,"+"),e=e.replace(/\s+/g,"+"),e=e.replace(/([^a-zA-Z0-9\u0080-\uFFFF +']+)/gi,""),e.toLowerCase()}function cookieBannerClose(){$("#player").empty()}function getButtonLoading(){return $(".button-loading").first().clone()}function getLoading(){return $(".loading").first().clone()}$(window).on("popstate",function(e){var t=e.originalEvent.state;if(t){var o=t.url,s=["settings","playlist","subscriptions"];for(i=0;i<s.length;i++)if(o.includes(s[i])){var l=$("#center-stage");return void loadResults([o,l],!0)}$("#main").html(t.context),$("title")[0].innerText=t.title}}),$(document).ready(function(){xhr=null,timeout=0,refreshCookie()}).on("keyup submit",".search-form",function(e){e.preventDefault();var t=this.action,o=$(this);clearTimeout(timeout),timeout=setTimeout(function(){var e=o.find(".q").val();if(e){e=cleanString(e);var s=$("#center-stage");t=t+"?q="+e,s.find(".results-header").data("q")!=e&&loadResults([t,s]),scrollToTop()}},250)}).on("click",".options-button",function(e){e.preventDefault();var t=this.href,o=$(this);clearTimeout(timeout),timeout=setTimeout(function(){var e=o.parents(".results").parent();loadResults([t,e]),scrollTo(e)},250)}).on("click",".showpod-link",function(e){e.preventDefault();var t=this.href,o=$(this),s=o.data("podid"),l=$("#center-stage");if(l.find("#showpod-c").data("podid")!=s){var n=["/episodes/"+s+"/","#episodes-collapse"];loadResults([t,l,loadResults,n])}scrollToTop()}).on("click",".login-link, .signup-link, .password-link, .index-link, .results-close",function(e){e.preventDefault();var t=this.href,o=$("#center-stage"),s=$(this);if(s.hasClass("results-close"))for(;;){if(confirm("Are you sure, buddy?"))break;return}o.find(".login").length||o.find(".dashboard").length?s.hasClass("login-link")?$("#login-collapse").collapse("show"):s.hasClass("signup-link")?$("#signup-collapse").collapse("show"):s.hasClass("password-link")?$("#password-collapse").collapse("show"):$("#splash-collapse").collapse("show"):loadResults([t,o]),scrollToTop()}).on("click",".browse-link",function(e){e.preventDefault();var t=this.href,o=$("#center-stage");o.find(".list").length?$(".results-collapse").collapse("show"):loadResults([t,o]),scrollToTop()}).on("click",".charts-link",function(e){e.preventDefault(),scrollTo($("#charts"))}).on("click",".last-played-link",function(e){e.preventDefault(),scrollTo($("#last-played"))}).on("click",".subscriptions-link",function(e){e.preventDefault();var t=this.href,o=$("#center-stage");o.find(".subscriptions").length?$(".results-collapse").collapse("show"):loadResults([t,o]),scrollToTop()}).on("click",".settings-link",function(e){e.preventDefault();var t=this.href,o=$("#center-stage");o.find(".settings").length||loadResults([t,o]),scrollToTop()}).on("click",".playlist-link",function(e){e.preventDefault();var t=this.href,o=$("#center-stage");o.find(".playlist").length?$(".results-collapse").collapse("show"):loadResults([t,o]),scrollToTop()}).on("submit",".settings-form",function(e){e.preventDefault();var t=this.method,o=this.action,s=$(this),l=s.serialize(),n=s.find("input[name=dark_theme]").is(":checked");s.find("button[type=submit]").html(getButtonLoading()),$.ajax({data:l,method:t,url:o}).fail(function(e,t,o){$("#center-stage").html(e.responseText),scrollToTop()}).done(function(e){pushState(o),n?$(".lights-toggle").removeClass("lit"):$(".lights-toggle").addClass("lit"),changeTheme(n),$("#center-stage").html(e),scrollToTop(),replaceState("/")})}).on("submit",".sub-form",function(e){e.preventDefault(),subscribeOrUnsubscribe(this)}).on("submit",".playlist-form",function(e){e.preventDefault();var t=$(this);clearTimeout(timeout),timeout=setTimeout(function(){var e=t[0].action,o=t.serialize(),s=t.find("input[name=mode]").val(),l=t.find("button[type=submit]");yeOldePlaylistFunction(e,o,s,l)},250)}).on("click",".player-close",function(e){for(e.preventDefault();;){if(confirm("Are you sure, buddy?"))break;return}$(this).siblings("audio")[0].preload="none",$("#player").empty(),updateTitle()}).on("click",".player-minimize",function(e){e.preventDefault(),$("#player-collapse").collapse("hide"),$(this).toggleClass("active").parents(".player-wrapper").toggleClass("minimize")}).on("submit",".login-form, .signup-form, .password-form",function(e){e.preventDefault();var t=this.method,o=this.action,s=$(this),l=s.serialize(),n=s.find("button[type=submit]"),i=n[0].innerText;n.html(getButtonLoading()),$.ajax({data:l,method:t,url:o}).fail(function(e,t,o){n.text(i),$(".splash-errors").html(e.responseText),$("html").on("click","body",function(){$(".splash-errors").empty()}),scrollToTop()}).done(function(e){$("#center-stage").html(e),"Send"==i?$("#login-tab").tab("show"):(refreshCookie(),refreshPage()),scrollToTop()})}).on("click",".view-button",function(e){e.preventDefault(),$(this).children().toggleClass("d-none").parents().siblings(".results-content").find($(".view-collapse")).each(function(){$(this).collapse("toggle")})}).on("mouseenter mouseleave",".view-button, .provider-button",function(){$(this).children().toggleClass("d-none")}).on("show.bs.collapse",".login-collapse",function(e){e.stopPropagation(),$(".login-collapse.show").collapse("hide")}).on("show.bs.collapse",".more-collapse",function(e){e.stopPropagation(),$(".more-collapse.show").collapse("hide");var t=$(this).parents("tr").prev();timeout=setTimeout(function(){scrollTo(t)},250)}).on("show.bs.collapse",".last-played-collapse",function(e){e.stopPropagation(),$(".last-played-collapse.show").collapse("hide");var t=$(this).parents();timeout=setTimeout(function(){scrollTo(t)},250)}).on("show.bs.collapse",".options-collapse",function(e){e.stopPropagation(),$(".options-collapse.show").collapse("hide")}).on("show.bs.collapse",".showpod-collapse",function(e){e.stopPropagation(),$(".showpod-collapse.show").collapse("hide")}).on("click",".lights-toggle",function(e){e.preventDefault(),$(".lights-toggle").toggleClass("lit"),changeTheme(!$(".lights-toggle").hasClass("lit"))}).on("click",".btn-dope, .dopebar-link, .last-played-toggle, .episode-header",function(e){$(this).blur()}).on("click","body, .dopebar-link, .search-button",function(e){$("#dopebar-collapse.show").collapse("hide")}).on("click","#dopebar",function(e){e.stopPropagation()}).on("click",".select-subscription",function(){var e=$(this).parents(".subscriptions-result").toggleClass("selected"),t=e.parents(".results").find(".subscriptions-result"),o=e.parents(".results").find(".selected");t.length==o.length?$(".select-all-button").addClass("active"):$(".select-all-button").removeClass("active")}).on("click",".select-all-button",function(){var e=$(this);e.hasClass("active")?e.parent().siblings().find(".subscriptions-result").removeClass("selected"):e.parent().siblings().find(".subscriptions-result").addClass("selected"),e.toggleClass("active")}).on("click",".unsubscribe-button",function(e){e.preventDefault();var t=this.href,o=$(this),s=[];if(o.hasClass("sub-nix"))s[0]=o.parent().parent().data("podid");else{var l=o.parent().siblings().find(".subscriptions-result.selected");if(!l.length)return;l.each(function(e,t){s[e]=$(t).data("podid")})}o.html(getButtonLoading()),$.ajax({method:"POST",url:t,data:{podids:s}}).fail(function(e,t,o){$("#center-stage").html(e.responseText),replaceState("/")}).done(function(e){$("#center-stage").html(e)})});
"use strict";var xhr=null,timeout=0,previous=0,charts=0;function dateLocalizer(){var tz=Intl.DateTimeFormat().resolvedOptions().timeZone;$.ajax({data:{tz:tz},method:"POST",url:"/tz/"});var date=new Date;tz=60*-date.getTimezoneOffset(),$(".date").each(function(){var utc,d=$(this).data("utc")+tz,d,dateString=("0"+(d=new Date(1e3*d)).getUTCDate()).slice(-2)+" "+d.toLocaleString("en-us",{month:"short"})+" "+d.getUTCFullYear()+" "+("0"+d.getUTCHours()).slice(-2)+":"+("0"+d.getUTCMinutes()).slice(-2);$(this).text(dateString)})}function trackMe(url){_paq.push(["trackPageView",url])}function pushState(url){for(var urls=["episodes","dopebar","subscriptions","playlist","charts","previous","change-password"],i=0;i<urls.length;i++)if(url.includes(urls[i]))return;titleUpdater();var main,context,state={context:$("#center-stage")[0].innerHTML,url:url};history.pushState(state,"",url),trackMe(url)}function replaceState(url){url=url.replace("episodes","showpod");for(var urls=["dopebar","subscriptions","playlist","charts","previous","change-password"],i=0;i<urls.length;i++)if(url.includes(urls[i]))return;var main=$("#center-stage");url&&!url.includes("unsubscribe")||(url=main[0].baseURI),titleUpdater();var context,state={context:main[0].innerHTML,url:url};history.replaceState(state,"",url)}function titleUpdater(){var title="dopepod",player=$("#player-wrapper"),header=$("#center-stage .results-bar h1"),episode;player.length?title="Now playing: "+(title=player.find("h1")[0].innerText)+" - "+player.find(".player-episode")[0].innerText+" | dopepod":header.length&&(title=$("#center-stage").children().hasClass("showpod")?"Listen to episodes of "+header[0].innerText+" | dopepod":header[0].innerText+" | dopepod");$("title")[0].innerText=title}function getCookie(name){var cookieValue=null;if(document.cookie&&""!==document.cookie)for(var cookies=document.cookie.split(";"),i=0;i<cookies.length;i++){var cookie=jQuery.trim(cookies[i]);if(cookie.substring(0,name.length+1)===name+"="){cookieValue=decodeURIComponent(cookie.substring(name.length+1));break}}return cookieValue}function csrfSafeMethod(method){return/^(GET|HEAD|OPTIONS|TRACE)$/.test(method)}function refreshCookie(){var csrftoken=getCookie("csrftoken");$.ajaxSetup({beforeSend:function(xhr,settings){csrfSafeMethod(settings.type)||this.crossDomain||xhr.setRequestHeader("X-CSRFToken",csrftoken)}})}function refreshPage(){getResults(["/dopebar/","#dopebar-wrapper",!1],!0),getResults(["/previous/","#previous",!1],!0),getResults(["/charts/","#charts",!1],!0),getResults(["/subscriptions/","#subscriptions",!1],!0),getResults(["/playlist/","#playlist",!1],!0)}function checkForXHR(url){if(null!=xhr){for(var urls=["dopebar","charts","episodes","previous","subscriptions","playlist"],i=0;i<urls.length;i++)if(url.includes(urls[i]))return;xhr.abort(),xhr=null}}function enableLoader(drop,url){drop.is("#player")?drop.find(".player-content").addClass("blurred"):drop.children(":not(.loader)").addClass("blurred");var loader=drop.find(".loader:last");loader.fadeIn("slow"),loader.filter(".reload-button").attr("href",url)}function disableLoader(drop){drop.children(":not(.loader)").removeClass("blurred");var loader=drop.find(".loader:last");loader.fadeOut("slow"),loader.filter(".reload-button").attr("href",url)}function getResults(args,no_loader,no_push){var url=args[0],drop=$(args[1]),scroll=args[2],callback=args[3],args=args[4];checkForXHR(url),no_push||pushState(url),no_loader||(drop.find(".results-collapse:not(.show)").collapse("show"),enableLoader(drop,url),scroll&&(url.includes("/charts/")||url.includes("/previous/")||scrollTo(drop))),xhr=$.ajax({type:"GET",url:url}).fail(function(xhr,ajaxOptions,thrownError){url.includes("/episodes/")&&"abort"!=thrownError?(podid=url.split("/")[2],podid&&noshow(podid)):url.includes("previous")?window.clearInterval(previous):url.includes("charts")&&window.clearInterval(charts)}).done(function(response){if(drop.html(response),lazyload(),callback)callback(args);else if(drop.is("#dopebar-wrapper")){var response,theme=(response=drop.children()).data("theme");response.removeData("theme"),response.removeAttr("data-theme"),themeChanger(theme)}scroll&&(url.includes("/charts/")||url.includes("/previous/"))&&$(window).width()<992&&scrollTo(drop),replaceState(url)})}function noshow(podid){$.ajax({data:{podid:podid},method:"POST",url:"/noshow/"})}function scrollSpy(){scrollUp(),playerUnfixer(),columnFixer()}function scrollUp(){var scroll;$(window).scrollTop()>300?$("#scroll-up").addClass("d-inline-block"):$("#scroll-up").removeClass("d-inline-block")}function scrollToTop(){$("html, body").animate({scrollTop:$("body").offset().top},250)}function scrollTo(obj){$("html, body").animate({scrollTop:obj.offset().top-44},250)}function scrollText(box,text){var boxWidth=box.innerWidth(),textWidth=text.width();if(textWidth>boxWidth){var animSpeed=30*textWidth;$(box).animate({scrollLeft:textWidth-boxWidth},animSpeed).animate({scrollLeft:0},animSpeed,function(){setTimeout(function(){scrollText(box,text)},1e3)})}}function playerUnfixer(){var x,y;$("#footer").offset().top>$(window).scrollTop()+$(window).height()?$("#player").addClass("fixed-bottom"):$("#player").removeClass("fixed-bottom")}function columnFixer(){$("#subscriptions, #playlist, #charts, #previous").stick_in_parent({offset_top:44})}function themeChanger(theme){for(var themes=["light","dark","christmas"],i=0;i<themes.length;i++)theme.includes(themes[i])&&$("body").removeClass().addClass(theme)}function postContact(form){var method=form.method,url=form.action,form,data=(form=$(form)).serialize(),drop=$("#center-stage");$.ajax({data:data,method:method,url:url}).fail(function(xhr,ajaxOptions,thrownError){drop.html(xhr.responseText),scrollToTop()}).done(function(response){drop.html(response),scrollToTop(),replaceState(url)}),enableLoader(drop,url)}function postSettings(form){var method=form.method,url=form.action,form,data=(form=$(form)).serialize(),theme=form.find("input[name=theme]").val(),drop=$("#center-stage");$.ajax({data:data,method:method,url:url}).fail(function(xhr,ajaxOptions,thrownError){drop.html(xhr.responseText),scrollToTop()}).done(function(response){theme&&themeChanger(theme),drop.html(response),scrollToTop(),replaceState(url)}),enableLoader(drop,url)}function postLogin(form){var method=form.method,url=form.action,form,data=(form=$(form)).serialize(),drop=$("#center-stage");form.find("button[type=submit].btn-dope").html(getButtonLoading()),$.ajax({data:data,method:method,url:url}).fail(function(xhr,ajaxOptions,thrownError){drop.html(xhr.responseText),scrollToTop()}).done(function(response){drop.html(response),scrollToTop(),(form.hasClass("login-form")||form.hasClass("tryout-form"))&&(refreshCookie(),refreshPage())})}function postSubscriptions(podid,button){clearTimeout(timeout),timeout=setTimeout(function(){var drop=$("#subscriptions");$.ajax({method:"POST",url:"/subscriptions/",data:{podid:podid}}).fail(function(xhr,ajaxOptions,thrownError){}).done(function(response){drop.children().length?drop.find(".results-collapse").html($(response).find(".results-collapse").children()):drop.html(response),drop.trigger("sticky_kit:recalc");var current_podid=$(".results.showpod").data("podid"),args;podid==current_podid&&getResults(["/showpod/"+podid,"#center-stage",!1,getResults,["/episodes/"+podid+"/",".showpod #episodes-content",!1]],!1,!0);getResults(["/charts/","#charts",!1])}),button.html(getButtonLoading())},250)}function postPlaylist(data,mode,button,pos){var drop=$("#playlist");try{var text=button[0].innerHTML}catch(e){}var url="/playlist/";if("play"==mode){var wrapper=$("#player-wrapper");wrapper.length&&(wrapper.removeClass("minimize"),wrapper.find("audio")[0].preload="none",enableLoader($("#player")))}$.ajax({method:"POST",url:url,data:data}).fail(function(xhr,ajaxOptions,thrownError){try{button.html(text)}catch(e){}$("#player").empty()}).done(function(response){if("play"==mode){var player=$("#player");player.html(response),titleUpdater();try{button.html(text)}catch(e){}setTimeout(function(){var box,text;scrollText(player.find("h1"),player.find("h1 span"))},1e3),pos&&drop.children().length&&getResults([url,drop,!1])}else"add"==mode&&button.html(text),drop.find(".results-collapse").html($(response).find(".results-collapse").children()),lazyload();drop.trigger("sticky_kit:recalc")});try{button.html(getButtonLoading())}catch(e){}}function playNext(){var mode="play",pos="1",data,button=void 0;postPlaylist({mode:mode,pos:"1"},mode,void 0,"1")}function closePlayer(){var player=$("#player");player.find("audio")[0].preload="none",player.empty(),titleUpdater()}function cleanString(q){return(q=(q=(q=q.replace(/&+/g,"+")).replace(/\s+/g,"+")).replace(/([^a-zA-Z0-9\u0080-\uFFFF +']+)/gi,"")).toLowerCase()}function getButtonLoading(){return $(".button-loading").first().clone()}function previousUpdater(){previous=setInterval(function(){$(".previous .expandable.expanded").length||getResults(["/previous/","#previous",!1],!0)},6e4)}function chartsUpdater(){charts=setInterval(function(){getResults(["/charts/","#charts",!1],!0)},864e5)}function hasTouch(){return navigator.maxTouchPoints||navigator.msMaxTouchPoints}function hoverDisabler(){hasTouch()?$("html").removeClass("no-touch"):$("html").addClass("no-touch")}function initPopular(){$("#popular-carousel").slick({autoplay:!0,infinite:!0,lazyload:"ondemand",prevArrow:"<button type='button' class='btn-dope slick-prev' title='Previous'><span><i class='fas fa-angle-left'></i></span></button>",nextArrow:"<button type='button' class='btn-dope slick-next' title='Next'><span><i class='fas fa-angle-right'></i></span></button>"}).show().slick("refresh")}function initListen(){$(".logo").toggleClass("d-none");for(var slides=$("#listen-carousel>*").toArray(),first=slides.shift(),i=slides.length-1;i>0;i--){var j=Math.floor(Math.random()*(i+1)),temp=slides[i];slides[i]=slides[j],slides[j]=temp}slides.unshift(first),$("#listen-carousel").html(slides).slick({autoplay:!0,fade:!0,initialSlide:1,lazyLoad:"ondemand",prevArrow:"<button type='button' class='btn-dope active slick-prev' title='Previous'><span><i class='fas fa-angle-left'></i></span></button>",nextArrow:"<button type='button' class='btn-dope active slick-next' title='Next'><span><i class='fas fa-angle-right'></i></span></button>"}).show().slick("refresh")}function removeErrors(){$(".errors").remove()}function lazyload(){var myLazyLoad=new LazyLoad({elements_selector:".lazyload"})}function toggleButtons(buttons){buttons.each(function(){$(this).children().slice(-2).toggleClass("d-none")})}function togglePopular(){var carousel=$("#popular-carousel"),index=carousel.slick("slickCurrentSlide"),cut=16;index>=16?carousel.slick("slickGoTo",0):index<16&&carousel.slick("slickGoTo",16)}refreshCookie(),dateLocalizer(),lazyload(),hoverDisabler(),$(document).ready(function(){replaceState(window.location.href),scrollSpy(),initListen(),initPopular(),previousUpdater(),chartsUpdater()}).scroll(function(){scrollSpy()}).on("submit",".search-form",function(e){e.preventDefault();var url=this.action,form,q=$(this).children(".q").val();if(q){q=cleanString(q);var drop=$("#center-stage");drop.children(".results").data("q")!=q?getResults([url=url+"?q="+q,drop,!0]):scrollTo(drop)}}).on("click",".reload-button",function(e){e.preventDefault();var url=this.href,button=$(this);clearTimeout(timeout),timeout=setTimeout(function(){var drop=button.parents(".loader").parent();if(drop.is("episodes-content"))getResults([url=url.replace("showpod","episodes"),drop,!1]);else if(drop.length){var podid=drop.children(".results.showpod").data("podid"),args;if(podid)getResults([url,drop,!1,getResults,["/episodes/"+podid+"/",".showpod #episodes-content",!1]]);else getResults([url,drop,!1])}},250)}).on("click",".options-button",function(e){e.preventDefault();var url=this.href,button=$(this),view=button.parents(".results").data("view");clearTimeout(timeout),timeout=setTimeout(function(){view&&(url.includes("view")?url=url.substring(0,url.indexOf("view"))+"view="+view:url+="&view="+view);var drop=button.parents(".results").parent();getResults([url,drop,!0])},250)}).on("click",".showpod .options-button",function(e){e.preventDefault();var url=this.href.replace("showpod","episodes"),button=$(this);clearTimeout(timeout),timeout=setTimeout(function(){var drop=button.parents("#episodes-content");getResults([url,drop,!1])},250)}).on("click",".showpod-link",function(e){e.preventDefault();var url=this.href,button,podid=$(this).data("podid"),drop=$("#center-stage"),args;drop.children(".results").data("podid")!=podid?getResults([url,drop,!0,getResults,["/episodes/"+podid+"/",".showpod #episodes-content",!1]]):scrollTo(drop)}).on("click",".login-link, .signup-link, .password-link, .index-link",function(e){e.preventDefault();var url=this.href,drop=$("#center-stage"),link=$(this);drop.find(".results-collapse").collapse("show"),drop.children(".splash").length||drop.children(".dashboard").length?(link.hasClass("login-link")?drop.find("#login-collapse").collapse("show"):link.hasClass("signup-link")?drop.find("#signup-collapse").collapse("show"):link.hasClass("password-link")?drop.find("#password-collapse").collapse("show"):drop.find("#splash-collapse").collapse("show"),link.hasClass("collapsed")&&drop.find("#splash-collapse").collapse("show"),scrollTo(drop)):getResults([url,drop,!0])}).on("click",".browse-link",function(e){e.preventDefault();var url=this.href,drop=$("#center-stage");drop.find(".results-collapse").collapse("show"),drop.children(".list").length||drop.children(".grid").length?window.location.href.includes("?")?getResults([url,drop,!0]):scrollTo(drop):getResults([url,drop,!0])}).on("click",".subscriptions-link",function(e){e.preventDefault();var url=this.href,drop=$("#subscriptions");drop.find(".results-collapse").collapse("show"),drop.children(".subscriptions").length?scrollTo(drop):getResults([url,drop,!0])}).on("click",".settings-link",function(e){e.preventDefault();var url=this.href,drop=$("#center-stage");drop.find(".results-collapse").collapse("show"),drop.children(".settings").length?scrollTo(drop):getResults([url,drop,!0])}).on("click",".playlist-link",function(e){e.preventDefault();var url=this.href,drop=$("#playlist");drop.find(".results-collapse").collapse("show"),drop.children(".playlist").length?scrollTo(drop):getResults([url,drop,!0])}).on("click",".charts-link",function(e){e.preventDefault(),scrollTo($("#charts"))}).on("click",".previous-link",function(e){e.preventDefault(),scrollTo($("#previous"))}).on("click",".privacy-link",function(e){e.preventDefault();var url=this.href,drop=$("#center-stage");drop.find(".results-collapse").collapse("show"),drop.children(".privacy").length?scrollTo(drop):getResults([url,drop,!0])}).on("click",".terms-link",function(e){e.preventDefault();var url=this.href,drop=$("#center-stage");drop.find(".results-collapse").collapse("show"),drop.children(".terms").length?scrollTo(drop):getResults([url,drop,!0])}).on("click",".api-link",function(e){e.preventDefault();var url=this.href,drop=$("#center-stage");drop.find(".results-collapse").collapse("show"),drop.children(".api").length?scrollTo(drop):getResults([url,drop,!0])}).on("click",".contact-link",function(e){e.preventDefault();var url=this.href,drop=$("#center-stage");drop.find(".results-collapse").collapse("show"),drop.children(".contact").length?scrollTo(drop):getResults([url,drop,!0])}).on("submit",".subscriptions-form",function(e){e.preventDefault();var form=$(this),button=form.children("button[type=submit]"),podid=form.children("input[name^=podid]").val();podid&&postSubscriptions(podid,button)}).on("click",".unsubscribe-button",function(e){e.preventDefault(),e.stopPropagation();var button=$(this),selected=button.parents(".results-collapse").find(".selectable.selected");if(selected.length)if(button.hasClass("exp"))console.log("asasd");else{var podid=[];selected.each(function(i,subscription){podid[i]=$(subscription).data("podid")}),podid&&postSubscriptions(podid,button)}}).on("submit",".playlist-form",function(e){e.preventDefault();var form=$(this);form.find(".button-loading").length||(clearTimeout(timeout),timeout=setTimeout(function(){var data=form.serialize(),mode=form.children("input[name=mode]").val(),pos=form.children("input[name=pos]").val(),button;postPlaylist(data,mode,form.children("button[type=submit]"),pos)},250))}).on("click",".player-minimize",function(e){e.preventDefault(),$("#player-collapse").collapse("hide"),$("#confirm-collapse-player").collapse("hide"),$(this).attr("aria-expanded",function(i,attr){return"true"==attr?"false":"true"}).parents("#player-wrapper").toggleClass("minimize")}).on("click",".theme-button[type=submit]",function(){var theme=$(this).children().text().toLowerCase();$(this).siblings("input[name=theme]").val(theme)}).on("submit",".contact-form",function(e){e.preventDefault(),postContact(this)}).on("submit",".settings-form",function(e){e.preventDefault(),postSettings(this)}).on("submit",".convert-form",function(e){e.preventDefault(),alert("Oops, this doesn't actually work yet. Sorry!")}).on("submit",".tryout-form, .login-form, .signup-form, .password-form, .password-reset-form",function(e){e.preventDefault(),postLogin(this)}).on("click",".showpod-button",function(e){e.preventDefault(),$(this).children(".d-none.active").length&&($(".showpod-content").toggleClass("d-none"),toggleButtons($(".showpod-button"))),scrollTo($(".showpod-content:not(.d-none)"))}).on("click",".popular-button",function(e){e.preventDefault(),$(this).children(".d-none.active").length&&togglePopular()}).on("click",".view-button",function(e){e.preventDefault();var icons=$(this).children().slice(-2),view=icons.filter(".d-none").data("view");icons.parents(".results").attr("data-view",view),icons.toggleClass("d-none"),$(".view-collapse").collapse("toggle")}).on("show.bs.collapse",".login-collapse",function(e){e.stopPropagation(),$(this).siblings(".login-collapse.show").collapse("hide"),removeErrors()}).on("show.bs.collapse",".more-collapse",function(e){e.stopPropagation(),$(this).parents(".results").find(".more-collapse.show").collapse("hide")}).on("shown.bs.collapse hidden.bs.collapse","#subscriptions .collapse, #playlist .collapse",function(e){e.stopPropagation();var drop=$(this).parents(".drop");setTimeout(function(){console.log(drop),drop.trigger("sticky_kit:recalc")},500)}).on("show.bs.collapse","#listen-carousel .more-collapse",function(e){e.stopPropagation(),$("#listen-carousel").slick("slickPause")}).on("hide.bs.collapse","#listen-carousel .more-collapse",function(e){e.stopPropagation(),$("#listen-carousel").slick("slickPlay")}).on("show.bs.collapse","#splash-collapse",function(){$("#listen-carousel.slick-initialized").length&&($("#listen-carousel").slick("slickPlay"),$("#listen-carousel").slick("slickGoTo",0))}).on("hide.bs.collapse","#splash-collapse",function(){$(this).find(".more-collapse.show").collapse("hide"),$("#listen-carousel.slick-initialized").length&&$("#listen-carousel").slick("slickPause")}).on("beforeChange","#listen-carousel",function(){$(this).find(".dope-result.expanded").removeClass("expanded"),$(this).find(".more-collapse.show").collapse("hide")}).on("beforeChange","#popular-carousel",function(e,slick,currentSlide,nextSlide){var carousel,half=$(this).find(".slick-slide").length-1;if(currentSlide<half){var cut=16;(currentSlide<cut&&nextSlide>=cut||currentSlide>=cut&&nextSlide<cut)&&(toggleButtons($(".popular-button")),$(".popular .results-bar span").toggleClass("d-none"))}else(currentSlide<(cut+=half)&&nextSlide>=cut||currentSlide>=cut&&nextSlide<cut)&&(toggleButtons($(".popular-button")),$(".popular .results-bar span").toggleClass("d-none"))}).on("show.bs.collapse",".options-collapse",function(e){e.stopPropagation(),$(".options-collapse.show").collapse("hide")}).on("show.bs.collapse",".settings-collapse",function(e){e.stopPropagation(),$(".settings-collapse.show").collapse("hide"),removeErrors()}).on("hidden.bs.collapse",".settings-collapse",function(e){$(".settings .dope-options .btn-dope[aria-expanded=true]").length||$(".settings-collapse:first").collapse("show")}).on("click",".select-theme",function(e){e.preventDefault();var theme=$("body").attr("class");"light"==theme?theme="dark":"dark"==theme?theme="christmas":"christmas"==theme&&(theme="light"),themeChanger(theme)}).on("click",".expandable .exp",function(){var button=$(this);button.parents(".results").find(".expandable.expanded").removeClass("expanded"),"true"===button.attr("aria-expanded")&&button.parents(".expandable").addClass("expanded")}).on("click",".btn-dope, .dope-link, .dope-dot, .episode-header, .search-button",function(){$(this).blur()}).on("click","a, button:not(.search-button)",function(){$(".q").val("")}).on("click","body, .dope-link, .search-button",function(){$("#dopebar-collapse.show").collapse("hide")}).on("click","#dopebar-collapse",function(e){e.stopPropagation()}).on("click","#scroll-up",function(){scrollToTop()}).on("click",".select",function(){$(this).parents(".selectable").toggleClass("selected");var buttons=$(".selectable"),selected=$(".selectable.selected");buttons.length==selected.length?$(".select-all").addClass("active"):$(".select-all").removeClass("active")}).on("click",".select-all",function(){var button=$(this),buttons=$(".selectable");buttons.length&&(button.hasClass("active")?buttons.removeClass("selected"):buttons.addClass("selected"),button.toggleClass("active"))}).on("click",".errors .btn-dope",function(){removeErrors()}),$(window).on("popstate",function(e){var state=e.originalEvent.state;if(state){for(var url=state.url,urls=["settings"],context=$(state.context),i=0;i<urls.length;i++)if(url.includes(urls[i])||context.hasClass("splash")||context.hasClass("dashboard")){var drop=$("#center-stage");return getResults([url,drop,!1],!1,!0)}$("#center-stage").html(state.context),context.hasClass("showpod")&&(drop=$("#episodes-content"),getResults([url=url.replace("showpod","episodes"),drop,!1])),titleUpdater(),lazyload()}}).on("blur",function(){window.clearInterval(charts),window.clearInterval(previous)}).on("focus",function(){previousUpdater(),chartsUpdater()}).on("resize",function(){hoverDisabler()});
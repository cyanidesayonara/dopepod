"use strict";function dateLocalizer(){var e=Intl.DateTimeFormat().resolvedOptions().timeZone;$.ajax({data:{tz:e},method:"POST",url:"/tz/"});var t=new Date;e=60*-t.getTimezoneOffset(),$(".date").each(function(){var t=$(this).data("utc"),s=t+e,s=new Date(1e3*s),o=("0"+s.getUTCDate()).slice(-2)+" "+s.toLocaleString("en-us",{month:"short"})+" "+s.getUTCFullYear()+" "+("0"+s.getUTCHours()).slice(-2)+":"+("0"+s.getUTCMinutes()).slice(-2);$(this).text(o)})}function trackMe(e){_paq.push(["trackPageView",e])}function pushState(e){for(var t=["episodes","dopebar","subscriptions","playlist","charts","previous","change-password"],s=0;s<t.length;s++)if(e.includes(t[s]))return;titleUpdater();var o=$("#center-stage"),l=o[0].innerHTML,n={context:l,url:e};history.pushState(n,"",e),trackMe(e)}function replaceState(e){e=e.replace("episodes","showpod");for(var t=["dopebar","subscriptions","playlist","charts","previous","change-password"],s=0;s<t.length;s++)if(e.includes(t[s]))return;var o=$("#center-stage");e&&!e.includes("unsubscribe")||(e=o[0].baseURI),titleUpdater();var l=o[0].innerHTML,n={context:l,url:e};history.replaceState(n,"",e)}function titleUpdater(){var e="dopepod",t=$("#player-wrapper"),s=$("#center-stage .results-bar h1");if(t.length){e=t.find("h1")[0].innerText;var o=t.find(".player-episode")[0].innerText;e="Now playing: "+e+" - "+o+" | dopepod"}else s.length&&(e=$("#center-stage").children().hasClass("showpod")?"Listen to episodes of "+s[0].innerText+" | dopepod":s[0].innerText+" | dopepod");$("title")[0].innerText=e}function getCookie(e){var t=null;if(document.cookie&&""!==document.cookie)for(var s=document.cookie.split(";"),o=0;o<s.length;o++){var l=jQuery.trim(s[o]);if(l.substring(0,e.length+1)===e+"="){t=decodeURIComponent(l.substring(e.length+1));break}}return t}function csrfSafeMethod(e){return/^(GET|HEAD|OPTIONS|TRACE)$/.test(e)}function refreshCookie(){var e=getCookie("csrftoken");$.ajaxSetup({beforeSend:function(t,s){csrfSafeMethod(s.type)||this.crossDomain||t.setRequestHeader("X-CSRFToken",e)}})}function refreshPage(){getResults(["/dopebar/","#dopebar-wrapper",!1],!0),getResults(["/previous/","#previous",!1],!0),getResults(["/charts/","#charts",!1],!0),getResults(["/subscriptions/","#subscriptions",!1],!0),getResults(["/playlist/","#playlist",!1],!0)}function checkForXHR(e){if(null!=xhr){for(var t=["dopebar","charts","episodes","previous","subscriptions","playlist"],s=0;s<t.length;s++)if(e.includes(t[s]))return;xhr.abort(),xhr=null}}function enableLoader(e,t){e.is("#player")?e.find(".player-content").addClass("blurred"):e.children(":not(.loader)").addClass("blurred");var s=e.find(".loader:last");s.fadeIn("slow"),s.filter(".reload-button").attr("href",t)}function disableLoader(e){e.children(":not(.loader)").removeClass("blurred");var t=e.find(".loader:last");t.fadeOut("slow"),t.filter(".reload-button").attr("href",url)}function getResults(e,t,s){var o=e[0],l=$(e[1]),n=e[2],a=e[3],e=e[4];checkForXHR(o),s||pushState(o),t||(l.find(".results-collapse:not(.show)").collapse("show"),enableLoader(l,o),n&&(o.includes("/charts/")||o.includes("/previous/")||scrollTo(l))),xhr=$.ajax({type:"GET",url:o}).fail(function(e,t,s){o.includes("/episodes/")&&"abort"!=s?(podid=o.split("/")[2],podid&&noshow(podid)):o.includes("previous")?window.clearInterval(previous):o.includes("charts")&&window.clearInterval(charts)}).done(function(t){if(l.html(t),lazyload(),a)a(e);else if(l.is("#dopebar-wrapper")){var t=l.children(),s=t.data("theme");t.removeData("theme"),t.removeAttr("data-theme"),themeChanger(s)}n&&(o.includes("/charts/")||o.includes("/previous/"))&&$(window).width()<992&&scrollTo(l),replaceState(o)})}function noshow(e){$.ajax({data:{podid:e},method:"POST",url:"/noshow/"})}function scrollSpy(){scrollUp(),playerUnfixer(),columnFixer()}function scrollUp(){var e=$(window).scrollTop();e>300?$("#scroll-up").addClass("d-inline-block"):$("#scroll-up").removeClass("d-inline-block")}function scrollToTop(){$("html, body").animate({scrollTop:$("body").offset().top},250)}function scrollTo(e){$("html, body").animate({scrollTop:e.offset().top-44},250)}function scrollText(e,t){var s=e.innerWidth(),o=t.width();if(o>s){var l=30*o;$(e).animate({scrollLeft:o-s},l).animate({scrollLeft:0},l,function(){setTimeout(function(){scrollText(e,t)},1e3)})}}function playerUnfixer(){var e=$("#footer").offset().top,t=$(window).scrollTop()+$(window).height();e>t?$("#player").addClass("fixed-bottom"):$("#player").removeClass("fixed-bottom")}function columnFixer(){$("#subscriptions, #playlist").stick_in_parent({offset_top:44})}function themeChanger(e){for(var t=["light","dark","christmas"],s=0;s<t.length;s++)e.includes(t[s])&&$("body").removeClass().addClass(e)}function postContact(e){var t=e.method,s=e.action,e=$(e),o=e.serialize(),l=$("#center-stage");$.ajax({data:o,method:t,url:s}).fail(function(e,t,s){l.html(e.responseText),scrollToTop()}).done(function(e){l.html(e),scrollToTop(),replaceState(s)}),enableLoader(l,s)}function postSettings(e){var t=e.method,s=e.action,e=$(e),o=e.serialize(),l=e.find("input[name=theme]").val(),n=$("#center-stage");$.ajax({data:o,method:t,url:s}).fail(function(e,t,s){n.html(e.responseText),scrollToTop()}).done(function(e){l&&themeChanger(l),n.html(e),scrollToTop(),replaceState(s)}),enableLoader(n,s)}function postLogin(e){var t=e.method,s=e.action,e=$(e),o=e.serialize(),l=$("#center-stage");e.find("button[type=submit].btn-dope").html(getButtonLoading()),$.ajax({data:o,method:t,url:s}).fail(function(e,t,s){l.html(e.responseText),scrollToTop()}).done(function(t){l.html(t),scrollToTop(),(e.hasClass("login-form")||e.hasClass("tryout-form"))&&(refreshCookie(),refreshPage())})}function postSubscriptions(e,t){clearTimeout(timeout),timeout=setTimeout(function(){var s=$("#subscriptions");$.ajax({method:"POST",url:"/subscriptions/",data:{podid:e}}).fail(function(e,t,s){}).done(function(t){s.children().length?s.find(".results-collapse").html($(t).find(".results-collapse").children()):s.html(t),s.trigger("sticky_kit:recalc");var o=$(".results.showpod").data("podid");if(e==o){var l=["/episodes/"+e+"/",".showpod #episodes-content",!1];getResults(["/showpod/"+e,"#center-stage",!1,getResults,l],!1,!0)}getResults(["/charts/","#charts",!1])}),t.html(getButtonLoading())},250)}function postPlaylist(e,t,s,o){var l=$("#playlist");try{var n=s[0].innerHTML}catch(e){}var a="/playlist/";if("play"==t){var i=$("#player-wrapper");i.length&&(i.removeClass("minimize"),i.find("audio")[0].preload="none",enableLoader($("#player")))}$.ajax({method:"POST",url:a,data:e}).fail(function(e,t,o){try{s.html(n)}catch(e){}$("#player").empty()}).done(function(e){if("play"==t){var i=$("#player");i.html(e),titleUpdater();try{s.html(n)}catch(e){}setTimeout(function(){var e=i.find("h1"),t=i.find("h1 span");scrollText(e,t)},1e3),o&&l.children().length&&getResults([a,l,!1])}else"add"==t&&s.html(n),l.find(".results-collapse").html($(e).find(".results-collapse").children()),l.trigger("sticky_kit:recalc")});try{s.html(getButtonLoading())}catch(e){}}function playNext(e){e&&(e=$(e));var t=1,s="play",o={pos:t,mode:s},l=$("#player-wrapper");l.length&&(l.removeClass("minimize"),l.find("audio")[0].preload="none",enableLoader($("#player"))),timeout=setTimeout(function(){postPlaylist(o,s,e,t)},500)}function closePlayer(){var e=$("#player");e.find("audio")[0].preload="none",e.empty(),titleUpdater()}function cleanString(e){return e=e.replace(/&+/g,"+"),e=e.replace(/\s+/g,"+"),e=e.replace(/([^a-zA-Z0-9\u0080-\uFFFF +']+)/gi,""),e.toLowerCase()}function getButtonLoading(){return $(".button-loading").first().clone()}function previousUpdater(){previous=setInterval(function(){$(".previous .expandable.expanded").length||getResults(["/previous/","#previous",!1],!0)},6e4)}function chartsUpdater(){charts=setInterval(function(){getResults(["/charts/","#charts",!1],!0)},864e5)}function hasTouch(){return navigator.maxTouchPoints||navigator.msMaxTouchPoints}function hoverDisabler(){hasTouch()?$("html").removeClass("no-touch"):$("html").addClass("no-touch")}function initPopular(){$(".popular-carousel").slick({autoplay:!0,infinite:!0,lazyload:"ondemand",prevArrow:"<button type='button' class='btn-dope slick-prev' title='Previous'><span><i class='fas fa-angle-left'></i></span></button>",nextArrow:"<button type='button' class='btn-dope slick-next' title='Next'><span><i class='fas fa-angle-right'></i></span></button>"}).show().slick("refresh")}function initListen(){$(".logo").toggleClass("d-none");for(var e=$(".listen-carousel>*").toArray(),t=e.shift(),s=e.length-1;s>0;s--){var o=Math.floor(Math.random()*(s+1)),l=e[s];e[s]=e[o],e[o]=l}e.unshift(t),$(".listen-carousel").html(e).slick({autoplay:!0,fade:!0,initialSlide:1,lazyLoad:"ondemand",prevArrow:"<button type='button' class='btn-dope slick-prev' title='Previous'><span><i class='fas fa-angle-left'></i></span></button>",nextArrow:"<button type='button' class='btn-dope slick-next' title='Next'><span><i class='fas fa-angle-right'></i></span></button>"}).show().slick("refresh")}function removeErrors(){$(".errors").remove()}function lazyload(){new LazyLoad({elements_selector:".lazyload"})}function toggleButtons(e){e.each(function(){$(this).children().slice(-2).toggleClass("d-none")})}function togglePopular(){var e=$(".popular-carousel"),t=e.slick("slickCurrentSlide"),s=16;t>=s?e.slick("slickGoTo",0):t<s&&e.slick("slickGoTo",s)}var xhr=null,timeout=0,previous=0,charts=0;refreshCookie(),dateLocalizer(),lazyload(),hoverDisabler(),$(document).ready(function(){replaceState(window.location.href),scrollSpy(),initListen(),initPopular(),previousUpdater(),chartsUpdater()}).scroll(function(){scrollSpy()}).on("submit",".search-form",function(e){e.preventDefault();var t=this.action,s=$(this),o=s.children(".q").val();if(o){o=cleanString(o);var l=$("#center-stage");l.children(".results").data("q")!=o?(t=t+"?q="+o,getResults([t,l,!0])):scrollTo(l)}}).on("click",".reload-button",function(e){e.preventDefault();var t=this.href,s=$(this);clearTimeout(timeout),timeout=setTimeout(function(){var e=s.parents(".loader").parent();if(e.is("episodes-content"))t=t.replace("showpod","episodes"),getResults([t,e,!1]);else if(e.length){var o=e.children(".results.showpod").data("podid");if(o){var l=["/episodes/"+o+"/",".showpod #episodes-content",!1];getResults([t,e,!1,getResults,l])}else getResults([t,e,!1])}},250)}).on("click",".options-button",function(e){e.preventDefault();var t=this.href,s=$(this),o=s.parents(".results").data("view");clearTimeout(timeout),timeout=setTimeout(function(){o&&(t.includes("view")?t=t.substring(0,t.indexOf("view"))+"view="+o:t+="&view="+o);var e=s.parents(".results").parent();getResults([t,e,!0])},250)}).on("click",".showpod .options-button",function(e){e.preventDefault();var t=this.href.replace("showpod","episodes"),s=$(this);clearTimeout(timeout),timeout=setTimeout(function(){var e=s.parents("#episodes-content");getResults([t,e,!1])},250)}).on("click",".showpod-link",function(e){e.preventDefault();var t=this.href,s=$(this),o=s.data("podid"),l=$("#center-stage");if(l.children(".results").data("podid")!=o){var n=["/episodes/"+o+"/",".showpod #episodes-content",!1];getResults([t,l,!0,getResults,n])}else scrollTo(l)}).on("click",".login-link, .signup-link, .password-link, .index-link",function(e){e.preventDefault();var t=this.href,s=$("#center-stage"),o=$(this);s.find(".results-collapse").collapse("show"),s.children(".splash").length||s.children(".dashboard").length?(o.hasClass("login-link")?s.find("#login-collapse").collapse("show"):o.hasClass("signup-link")?s.find("#signup-collapse").collapse("show"):o.hasClass("password-link")?s.find("#password-collapse").collapse("show"):s.find("#splash-collapse").collapse("show"),o.hasClass("collapsed")&&s.find("#splash-collapse").collapse("show"),scrollTo(s)):getResults([t,s,!0])}).on("click",".browse-link",function(e){e.preventDefault();var t=this.href,s=$("#center-stage");s.find(".results-collapse").collapse("show"),s.children(".list").length||s.children(".grid").length?window.location.href.includes("?")?getResults([t,s,!0]):scrollTo(s):getResults([t,s,!0])}).on("click",".subscriptions-link",function(e){e.preventDefault();var t=this.href,s=$("#subscriptions");s.find(".results-collapse").collapse("show"),s.children(".subscriptions").length?scrollTo(s):getResults([t,s,!0])}).on("click",".settings-link",function(e){e.preventDefault();var t=this.href,s=$("#center-stage");s.find(".results-collapse").collapse("show"),s.children(".settings").length?scrollTo(s):getResults([t,s,!0])}).on("click",".playlist-link",function(e){e.preventDefault();var t=this.href,s=$("#playlist");s.find(".results-collapse").collapse("show"),s.children(".playlist").length?scrollTo(s):getResults([t,s,!0])}).on("click",".charts-link",function(e){e.preventDefault(),scrollTo($("#charts"))}).on("click",".previous-link",function(e){e.preventDefault(),scrollTo($("#previous"))}).on("click",".privacy-link",function(e){e.preventDefault();var t=this.href,s=$("#center-stage");s.find(".results-collapse").collapse("show"),s.children(".privacy").length?scrollTo(s):getResults([t,s,!0])}).on("click",".terms-link",function(e){e.preventDefault();var t=this.href,s=$("#center-stage");s.find(".results-collapse").collapse("show"),s.children(".terms").length?scrollTo(s):getResults([t,s,!0])}).on("click",".api-link",function(e){e.preventDefault();var t=this.href,s=$("#center-stage");s.find(".results-collapse").collapse("show"),s.children(".api").length?scrollTo(s):getResults([t,s,!0])}).on("click",".contact-link",function(e){e.preventDefault();var t=this.href,s=$("#center-stage");s.find(".results-collapse").collapse("show"),s.children(".contact").length?scrollTo(s):getResults([t,s,!0])}).on("submit",".subscriptions-form",function(e){e.preventDefault();var t=$(this),s=t.children("button[type=submit]"),o=t.children("input[name^=podid]").val();o&&postSubscriptions(o,s)}).on("click",".unsubscribe-button",function(e){e.preventDefault();var t=$(this),s=t.parents(".results-collapse").find(".selectable.selected");if(s.length){var o=[];s.each(function(e,t){o[e]=$(t).data("podid")}),o&&postSubscriptions(o,t)}}).on("submit",".playlist-form",function(e){e.preventDefault();var t=$(this);t.find(".button-loading").length||(clearTimeout(timeout),timeout=setTimeout(function(){var e=t.serialize(),s=t.children("input[name=mode]").val(),o=t.children("input[name=pos]").val(),l=t.children("button[type=submit]");postPlaylist(e,s,l,o)},250))}).on("click",".player-close",function(e){e.preventDefault(),closePlayer()}).on("click",".player-minimize",function(e){e.preventDefault(),$("#player-collapse").collapse("hide"),$("#player-close-collapse").collapse("hide"),$(this).attr("aria-expanded",function(e,t){return"true"==t?"false":"true"}).parents("#player-wrapper").toggleClass("minimize")}).on("click",".theme-button[type=submit]",function(){var e=$(this).children().text().toLowerCase();$(this).siblings("input[name=theme]").val(e)}).on("submit",".contact-form",function(e){e.preventDefault(),postContact(this)}).on("submit",".settings-form",function(e){e.preventDefault(),postSettings(this)}).on("submit",".convert-form",function(e){e.preventDefault(),alert("Oops, this doesn't actually work yet. Sorry!")}).on("submit",".tryout-form, .login-form, .signup-form, .password-form, .password-reset-form",function(e){e.preventDefault(),postLogin(this)}).on("click",".showpod-button",function(e){e.preventDefault(),$(this).children(".d-none.active").length&&($(".showpod-content").toggleClass("d-none"),toggleButtons($(".showpod-button"))),scrollTo($(".showpod-content:not(.d-none)"))}).on("click",".popular-button",function(e){e.preventDefault(),$(this).children(".d-none.active").length&&togglePopular()}).on("click",".view-button",function(e){e.preventDefault();var t=$(this).children().slice(-2),s=t.filter(".d-none").data("view");t.parents(".results").attr("data-view",s),t.toggleClass("d-none"),$(".view-collapse").collapse("toggle")}).on("show.bs.collapse",".login-collapse",function(e){e.stopPropagation(),$(".login-collapse.show").collapse("hide"),removeErrors()}).on("show.bs.collapse",".more-collapse",function(e){e.stopPropagation();var t=$(this).parents(".results");t.find(".more-collapse.show").collapse("hide"),t.hasClass("playlist")&&t.trigger("sticky_kit:recalc")}).on("show.bs.collapse",".previous-collapse",function(e){e.stopPropagation(),$(".previous-collapse.show").collapse("hide")}).on("show.bs.collapse",".splash-play-collapse",function(e){e.stopPropagation(),$(".listen-carousel").slick("slickPause")}).on("hide.bs.collapse",".splash-play-collapse",function(e){e.stopPropagation(),$(".listen-carousel").slick("slickPlay")}).on("show.bs.collapse","#splash-collapse",function(){$(".listen-carousel.slick-initialized").length&&($(".listen-carousel").slick("slickPlay"),$(".listen-carousel").slick("slickGoTo",0))}).on("hide.bs.collapse","#splash-collapse",function(){$(".splash-play-collapse.show").collapse("hide"),$(".listen-carousel.slick-initialized").length&&$(".listen-carousel").slick("slickPause")}).on("beforeChange",".listen-carousel",function(){$("#splash-play-result.expanded").removeClass("expanded"),$(".splash-play-collapse.show").collapse("hide")}).on("beforeChange",".popular-carousel",function(e,t,s,o){var l=$(this),n=l.find(".slick-slide").length-1;if(s<n){var a=16;(s<a&&o>=a||s>=a&&o<a)&&(toggleButtons($(".popular-button")),$(".popular .results-bar span").toggleClass("d-none"))}else a+=n,(s<a&&o>=a||s>=a&&o<a)&&(toggleButtons($(".popular-button")),$(".popular .results-bar span").toggleClass("d-none"))}).on("show.bs.collapse",".options-collapse",function(e){e.stopPropagation(),$(".options-collapse.show").collapse("hide")}).on("shown.bs.collapse hidden.bs.collapse",".collapse",function(e){$(".is_stuck").trigger("sticky_kit:recalc")}).on("show.bs.collapse",".settings-collapse",function(e){e.stopPropagation(),$(".settings-collapse.show").collapse("hide"),removeErrors()}).on("hidden.bs.collapse",".settings-collapse",function(e){$(".settings .dope-options .btn-dope[aria-expanded=true]").length||$(".settings-collapse:first").collapse("show")}).on("click",".select-theme",function(e){e.preventDefault();var t=$("body").attr("class");"light"==t?t="dark":"dark"==t?t="christmas":"christmas"==t&&(t="light"),themeChanger(t)}).on("click",".expandable .exp",function(){var e=$(this);e.parents(".results").find(".expandable.expanded").removeClass("expanded"),"true"===e.attr("aria-expanded")&&e.parents(".expandable").addClass("expanded")}).on("click",".btn-dope, .dope-link, .dope-toggle, .episode-header, .search-button",function(){$(this).blur()}).on("click","a, button:not(.search-button)",function(){$(".q").val("")}).on("click","body, .dope-link, .search-button",function(){$("#dopebar-collapse.show").collapse("hide")}).on("click","#dopebar-collapse",function(e){e.stopPropagation()}).on("click","#scroll-up",function(){scrollToTop()}).on("click",".select",function(){$(this).parents(".selectable").toggleClass("selected");var e=$(".selectable"),t=$(".selectable.selected");e.length==t.length?$(".select-all").addClass("active"):$(".select-all").removeClass("active")}).on("click",".select-all",function(){var e=$(this),t=$(".selectable");t.length&&(e.hasClass("active")?t.removeClass("selected"):t.addClass("selected"),e.toggleClass("active"))}).on("click",".errors .btn-dope",function(){removeErrors()}),$(window).on("popstate",function(e){var t=e.originalEvent.state;if(t){for(var s=t.url,o=["settings"],l=$(t.context),n=0;n<o.length;n++)if(s.includes(o[n])||l.hasClass("splash")||l.hasClass("dashboard")){var a=$("#center-stage");return getResults([s,a,!1],!1,!0)}$("#center-stage").html(t.context),titleUpdater(),l.hasClass("showpod")&&(a=$("#episodes-content"),s=s.replace("showpod","episodes"),getResults([s,a,!1]))}}).on("blur",function(){window.clearInterval(charts),window.clearInterval(previous)}).on("focus",function(){previousUpdater(),chartsUpdater()}).on("resize",function(){hoverDisabler()});
"use strict";function dateLocalizer(){var e=Intl.DateTimeFormat().resolvedOptions().timeZone;$.ajax({data:{tz:e},method:"POST",url:"/tz/"});var t=new Date;e=60*-t.getTimezoneOffset(),$(".date").each(function(){var t=$(this).data("utc"),l=t+e,l=new Date(1e3*l),s=("0"+l.getUTCDate()).slice(-2)+" "+l.toLocaleString("en-us",{month:"short"})+" "+l.getUTCFullYear()+" "+("0"+l.getUTCHours()).slice(-2)+":"+("0"+l.getUTCMinutes()).slice(-2);$(this).text(s)})}function trackMe(e){_paq.push(["trackPageView",e])}function pushState(e){for(var t=["episodes","dopebar","charts","last-played","change-password"],l=0;l<t.length;l++)if(e.includes(t[l]))return;titleUpdater();var s=$("#main"),o=s[0].innerHTML,n={context:o,url:e};history.pushState(n,"",e),trackMe(e)}function replaceState(e){e=e.replace("episodes","showpod");for(var t=["dopebar","charts","last-played","change-password"],l=0;l<t.length;l++)if(e.includes(t[l]))return;var s=$("#main");e&&!e.includes("unsubscribe")||(e=s[0].baseURI),titleUpdater();var o=s[0].innerHTML,n={context:o,url:e};history.replaceState(n,"",e)}function titleUpdater(){var e="dopepod",t=$("#player-wrapper"),l=$("#center-stage .results-bar h1");if(t.length){e=t.find("h1")[0].innerText;var s=t.find(".player-episode")[0].innerText;e="Now playing: "+e+" - "+s+" | dopepod"}else l.length&&(e=$("#center-stage").children().hasClass("showpod")?"Listen to episodes of "+l[0].innerText+" | dopepod":l[0].innerText+" | dopepod");$("title")[0].innerText=e}function getCookie(e){var t=null;if(document.cookie&&""!==document.cookie)for(var l=document.cookie.split(";"),s=0;s<l.length;s++){var o=jQuery.trim(l[s]);if(o.substring(0,e.length+1)===e+"="){t=decodeURIComponent(o.substring(e.length+1));break}}return t}function csrfSafeMethod(e){return/^(GET|HEAD|OPTIONS|TRACE)$/.test(e)}function refreshCookie(){var e=getCookie("csrftoken");$.ajaxSetup({beforeSend:function(t,l){csrfSafeMethod(l.type)||this.crossDomain||t.setRequestHeader("X-CSRFToken",e)}})}function refreshPage(){getResults(["/dopebar/","#dopebar",!1],!0),getResults(["/last-played/","#last-played",!1],!0)}function checkForXHR(e){if(null!=xhr){for(var t=["dopebar","charts","episodes","last-played","splash-play"],l=0;l<t.length;l++)if(e.includes(t[l]))return;xhr.abort(),xhr=null}}function getResults(e,t,l){var s=e[0],o=$(e[1]),n=e[2],a=e[3],e=e[4];if(checkForXHR(s),l||pushState(s),xhr=$.ajax({type:"GET",url:s}).fail(function(e,t,l){s.includes("/episodes/")?(podid=s.split("/")[2],podid&&noshow(podid)):s.includes("last-played")?window.clearInterval(last_played):s.includes("splash-play")?window.clearInterval(splash_play):s.includes("charts")&&window.clearInterval(charts)}).done(function(t){if(o.html(t),a)a(e);else if(o.is("#dopebar")){var t=o.children(),l=t.data("theme");t.removeData("theme"),t.removeAttr("data-theme"),themeChanger(l)}n&&(s.includes("/charts/")||s.includes("/last-played/"))&&$(window).width()<992&&scrollTo(o),replaceState(s)}),!t&&!o.children(".loading").length){var i=o.children(".results");i.length?i.addClass("loading").children(".results-collapse").html(getCircleLoading()):o.find("#episodes-collapse").html(getCircleLoading()),n&&(s.includes("/charts/")||s.includes("/last-played/")||s.includes("/splash-play/")||scrollTo(o))}}function noshow(e){$.ajax({data:{podid:e},method:"POST",url:"/noshow/"})}function scrollSpy(){$(window).scroll(function(){scrollUp(),playerUnfixer()})}function scrollUp(){var e=$(window).scrollTop();e>300?$(".scroll-up").addClass("d-sm-block"):$(".scroll-up").removeClass("d-sm-block")}function scrollToTop(){$("html, body").animate({scrollTop:$("body").offset().top},250)}function scrollTo(e){$("html, body").animate({scrollTop:e.offset().top-44},250)}function scrollText(e,t){var l=e.innerWidth(),s=t.width();if(s>l){var o=30*s;$(e).animate({scrollLeft:s-l},o).animate({scrollLeft:0},o,function(){setTimeout(function(){scrollText(e,t)},1e3)})}}function playerUnfixer(){var e=$("#footer").offset().top,t=$(window).scrollTop()+$(window).height();e>t?$("#player").addClass("fixed-bottom"):$("#player").removeClass("fixed-bottom")}function themeChanger(e){for(var t=["light","dark","christmas"],l=0;l<t.length;l++)e.includes(t[l])&&$("body").removeClass().addClass(e)}function postContact(e){var t=e.method,l=e.action,e=$(e),s=e.serialize(),o=$("#center-stage");$.ajax({data:s,method:t,url:l}).fail(function(e,t,l){$("#center-stage").html(e.responseText),scrollToTop()}).done(function(e){o.html(e),scrollToTop(),replaceState(l)}),o.children(".results").addClass("loading").children(".results-collapse").html(getCircleLoading())}function postSettings(e){var t=e.method,l=e.action,e=$(e),s=e.serialize(),o=e.find("input[name=theme]").val(),n=$("#center-stage");$.ajax({data:s,method:t,url:l}).fail(function(e,t,l){$("#center-stage").html(e.responseText),scrollToTop()}).done(function(e){o&&themeChanger(o),n.html(e),scrollToTop(),replaceState(l)}),n.children(".results").addClass("loading").children(".results-collapse").html(getCircleLoading())}function postLogin(e){var t=e.method,l=e.action,e=$(e),s=e.serialize(),o=e.find("button[type=submit]"),n=o[0].innerText;$.ajax({data:s,method:t,url:l}).fail(function(e,t,l){$("#center-stage").html(e.responseText),scrollToTop()}).done(function(e){$("#center-stage").html(e),"Login"===n&&(refreshCookie(),refreshPage()),scrollToTop()}),o.html(getButtonLoading())}function postSubscriptions(e,t){clearTimeout(timeout),timeout=setTimeout(function(){var l=$("#center-stage");$.ajax({method:"POST",url:"/subscriptions/",data:{podids:e}}).fail(function(e,t,s){l.html(e.responseText),replaceState("/")}).done(function(t){if(l.html(t),$(t).hasClass("showpod")){var s="/episodes/"+e+"/";l=".showpod .results-content",getResults([s,l,!1])}else scrollTo(l)}),t.html(getButtonLoading())},250)}function postPlaylist(e,t,l){var s=$("#center-stage"),o=l[0].innerHTML,n="/playlist/";$.ajax({method:"POST",url:n,data:e}).fail(function(e,t,s){l.html(o),$("#player").empty()}).done(function(e){"play"==t?($("#player").html(e),titleUpdater(),l.html(o),setTimeout(function(){var e=$("#player-wrapper h1"),t=$("#player-wrapper h1 span");scrollText(e,t)},1e3),s.children(".playlist").length&&getResults([n,s,!1])):("add"==t&&l.text(o),s.children(".playlist").length&&s.html(e))}),l.is("#player-wrapper")?l.html(getCircleLoading()):l.html(getButtonLoading())}function playNext(){var e={pos:"1",mode:"play"},t="play",l=$("#player-wrapper");l.children("audio")[0].preload="none",l.empty(),timeout=setTimeout(function(){postPlaylist(e,t,l)},500)}function closePlayer(){var e=$("#player");e.find("audio")[0].preload="none",e.empty(),titleUpdater()}function cleanString(e){return e=e.replace(/&+/g,"+"),e=e.replace(/\s+/g,"+"),e=e.replace(/([^a-zA-Z0-9\u0080-\uFFFF +']+)/gi,""),e.toLowerCase()}function getButtonLoading(){return $(".button-loading").first().clone()}function getCircleLoading(){return $(".circle-loading").first().clone()}function lastPlayedUpdater(){last_played=setInterval(function(){$(".last-played .expandable.expanded").length||getResults(["/last-played/","#last-played",!1],!0)},6e4)}function chartsUpdater(){charts=setInterval(function(){getResults(["/charts/","#charts",!1],!0)},864e5)}function hasTouch(){return navigator.maxTouchPoints||navigator.msMaxTouchPoints}function hoverDisabler(){hasTouch()?$("html").removeClass("no-touch"):$("html").addClass("no-touch")}function initSlick(){$(".slick").slick({autoplay:!0,prevArrow:"<button type='button' class='btn-dope slick-prev'><i class='fas fa-angle-left' title='Previous'></i></button>",nextArrow:"<button type='button' class='btn-dope slick-next'><i class='fas fa-angle-right' title='Next'></i></button>"})}function initSlickListen(){timeout=setTimeout(function(){$(".logo").toggleClass("d-none");for(var e=$(".slick-listen .slick-slide").toArray(),t=e.shift(),l=e.length-1;l>0;l--){var s=Math.floor(Math.random()*(l+1)),o=e[l];e[l]=e[s],e[s]=o}e.unshift(t),$(".slick-listen").html(e),$(".slick-listen").slick({autoplay:!0,fade:!0,initialSlide:1,prevArrow:"<button type='button' class='btn-dope slick-prev'><i class='fas fa-angle-left' title='Previous'></i></button>",nextArrow:"<button type='button' class='btn-dope slick-next'><i class='fas fa-angle-right' title='Next'></i></button>"})},3e3)}var xhr=null,timeout=0,last_played=0,charts=0;$(document).ready(function(){initSlick(),initSlickListen(),scrollToTop(),refreshCookie(),scrollUp(),playerUnfixer(),scrollSpy(),lastPlayedUpdater(),chartsUpdater(),dateLocalizer(),hoverDisabler(),replaceState(window.location.href)}).on("submit",".search-form",function(e){e.preventDefault();var t=this.action,l=$(this),s=l.children(".q").val();if(s){s=cleanString(s);var o=$("#center-stage");o.children(".results").data("q")!=s?(t=t+"?q="+s,getResults([t,o,!0])):scrollTo(o)}}).on("click",".options-button",function(e){e.preventDefault();var t=this.href,l=$(this),s=l.parents(".results").data("view");clearTimeout(timeout),timeout=setTimeout(function(){s&&(t.includes("view")?t=t.substring(0,t.indexOf("view"))+"view="+s:t+="&view="+s);var e=l.parents(".results").parent();getResults([t,e,!0])},250)}).on("click",".showpod .options-button",function(e){e.preventDefault();var t=this.href.replace("showpod","episodes"),l=$(this);clearTimeout(timeout),timeout=setTimeout(function(){var e=l.parents(".results-content");getResults([t,e,!1])},250)}).on("click",".showpod-link",function(e){e.preventDefault();var t=this.href,l=$(this),s=l.data("podid"),o=$("#center-stage");if(o.find(".results-collapse").collapse("show"),o.children(".results").data("podid")!=s){var n=["/episodes/"+s+"/",".showpod .results-content",!1];getResults([t,o,!0,getResults,n])}else scrollTo(o)}).on("click",".login-link, .signup-link, .password-link, .index-link",function(e){e.preventDefault();var t=this.href,l=$("#center-stage"),s=$(this);l.find(".results-collapse").collapse("show"),l.children(".splash").length||l.children(".dashboard").length?(s.hasClass("login-link")?l.find("#login-collapse").collapse("show"):s.hasClass("signup-link")?l.find("#signup-collapse").collapse("show"):s.hasClass("password-link")?l.find("#password-collapse").collapse("show"):l.find("#splash-collapse").collapse("show"),s.hasClass("collapsed")&&l.find("#splash-collapse").collapse("show"),scrollTo(l)):getResults([t,l,!0])}).on("click",".browse-link",function(e){e.preventDefault();var t=this.href,l=$("#center-stage");l.find(".results-collapse").collapse("show"),l.children(".list").length||l.children(".grid").length?window.location.href.includes("?")?getResults([t,l,!0]):scrollTo(l):getResults([t,l,!0])}).on("click",".subscriptions-link",function(e){e.preventDefault();var t=this.href,l=$("#center-stage");l.find(".results-collapse").collapse("show"),l.children(".subscriptions").length?scrollTo(l):getResults([t,l,!0])}).on("click",".settings-link",function(e){e.preventDefault();var t=this.href,l=$("#center-stage");l.find(".results-collapse").collapse("show"),l.children(".settings").length?scrollTo(l):getResults([t,l,!0])}).on("click",".playlist-link",function(e){e.preventDefault();var t=this.href,l=$("#center-stage");l.find(".results-collapse").collapse("show"),l.children(".playlist").length?scrollTo(l):getResults([t,l,!0])}).on("click",".charts-link",function(e){e.preventDefault(),scrollTo($("#charts"))}).on("click",".last-played-link",function(e){e.preventDefault(),scrollTo($("#last-played"))}).on("click",".privacy-link",function(e){e.preventDefault();var t=this.href,l=$("#center-stage");l.find(".results-collapse").collapse("show"),l.children(".privacy").length?scrollTo(l):getResults([t,l,!0])}).on("click",".terms-link",function(e){e.preventDefault();var t=this.href,l=$("#center-stage");l.find(".results-collapse").collapse("show"),l.children(".terms").length?scrollTo(l):getResults([t,l,!0])}).on("click",".api-link",function(e){e.preventDefault();var t=this.href,l=$("#center-stage");l.find(".results-collapse").collapse("show"),l.children(".api").length?scrollTo(l):getResults([t,l,!0])}).on("click",".contact-link",function(e){e.preventDefault();var t=this.href,l=$("#center-stage");l.find(".results-collapse").collapse("show"),l.children(".contact").length?scrollTo(l):getResults([t,l,!0])}).on("submit",".subscriptions-form",function(e){e.preventDefault();var t=$(this),l=t.children("button[type=submit]"),s=t.children("input[name=podid]").val();s||(s=[],s[0]=t.children("input[name^=podids]").val()),s&&postSubscriptions(s,l)}).on("click",".unsubscribe-button",function(e){e.preventDefault();var t=$(this),l=t.parents(".results-content").find(".grid-result.selected");if(l.length){var s=[];l.each(function(e,t){s[e]=$(t).data("podid")}),s&&postSubscriptions(s,t)}}).on("submit",".playlist-form",function(e){e.preventDefault();var t=$(this);t.find(".button-loading").length||(clearTimeout(timeout),timeout=setTimeout(function(){var e=t.serialize(),l=t.children("input[name=mode]").val(),s=t.children("button[type=submit]");postPlaylist(e,l,s)},250))}).on("click",".player-close",function(e){e.preventDefault(),closePlayer()}).on("click",".player-minimize",function(e){e.preventDefault(),$("#player-collapse").collapse("hide"),$("#player-close-collapse").collapse("hide"),$(this).attr("aria-expanded",function(e){return"true"==e?"false":"true"}).parents("#player-wrapper").toggleClass("minimize")}).on("click",".theme-button[type=submit]",function(){var e=this.innerText.toLowerCase();$(this).siblings("input[name=theme]").val(e)}).on("submit",".contact-form",function(e){e.preventDefault(),postContact(this)}).on("submit",".settings-form",function(e){e.preventDefault(),postSettings(this)}).on("submit",".login-form, .signup-form, .password-form, .password-reset-form",function(e){e.preventDefault(),postLogin(this)}).on("click",".view-button",function(e){e.preventDefault();var t=$(this),l=t.children(".d-none").data("view");t.children().toggleClass("d-none"),t.parents(".results").attr("data-view",l),$(".view-collapse").collapse("toggle")}).on("mouseenter mouseleave",".no-touch .order-button, .no-touch .view-button",function(){$(this).children().toggleClass("d-none")}).on("show.bs.collapse",".login-collapse",function(e){e.stopPropagation(),$(".login-collapse.show").collapse("hide")}).on("show.bs.collapse",".more-collapse",function(e){e.stopPropagation(),$(".more-collapse.show").collapse("hide")}).on("show.bs.collapse",".last-played-collapse",function(e){e.stopPropagation(),$(".last-played-collapse.show").collapse("hide")}).on("show.bs.collapse",".splash-play-collapse",function(e){e.stopPropagation(),$(".slick-listen").slick("slickPause")}).on("hide.bs.collapse",".splash-play-collapse",function(e){e.stopPropagation(),$(".slick-listen").slick("slickPlay")}).on("show.bs.collapse","#splash-collapse",function(){$(".slick-listen.slick-initialized").length&&($(".slick-listen").slick("slickPlay"),$(".slick-listen").slick("slickGoTo",0))}).on("hide.bs.collapse","#splash-collapse",function(){$(".splash-play-collapse.show").collapse("hide"),$(".slick-listen.slick-initialized").length&&$(".slick-listen").slick("slickPause")}).on("beforeChange",".slick-listen",function(){$("#splash-play-result.expanded").removeClass("expanded"),$(".splash-play-collapse.show").collapse("hide")}).on("show.bs.collapse",".options-collapse",function(e){e.stopPropagation(),$(".options-collapse.show").collapse("hide")}).on("show.bs.collapse",".settings-collapse",function(e){e.stopPropagation(),$(".settings-collapse.show").collapse("hide")}).on("show.bs.collapse",".showpod-collapse",function(e){e.stopPropagation(),$(".showpod-collapse.show").collapse("hide")}).on("click",".select-theme",function(e){e.preventDefault();var t=$("body").attr("class");"light"==t?t="dark":"dark"==t?t="christmas":"christmas"==t&&(t="light"),themeChanger(t)}).on("click",".expandable .exp",function(){$(".expandable.expanded").removeClass("expanded");var e=$(this);"true"===e.attr("aria-expanded")&&e.parents(".expandable").addClass("expanded")}).on("click","#splash-play-result .exp",function(){$("#splash-play-result.expanded").removeClass("expanded");var e=$(this);"true"===e.attr("aria-expanded")&&e.parents("#splash-play-result").addClass("expanded")}).on("click",".btn-dope, .dope-link, .dope-toggle, .episode-header, .search-button",function(){$(this).blur()}).on("click","a, button:not(.search-button)",function(){$(".q").val("")}).on("click","body",function(){$(".errors").delay(2e3).fadeOut("slow",function(){$(this).remove()})}).on("click","body, .dope-link, .search-button",function(){$("#dopebar-collapse.show").collapse("hide")}).on("click","#dopebar",function(e){e.stopPropagation()}).on("click",".scroll-up",function(){scrollToTop()}).on("click",".select",function(){$(this).parents(".selectable").toggleClass("selected");var e=$(".selectable"),t=$(".selectable.selected");e.length==t.length?$(".select-all").addClass("active"):$(".select-all").removeClass("active")}).on("click",".select-all",function(){var e=$(this);e.hasClass("active")?$(".selectable").removeClass("selected"):$(".selectable").addClass("selected"),e.toggleClass("active")}).on("click",".cookie-banner-close",function(){$("#player").empty()}),$(window).on("popstate",function(e){var t=e.originalEvent.state;if(t){for(var l=t.url,s=["settings","playlist","subscriptions"],o=0;o<s.length;o++)if(l.includes(s[o])){var n=$("#center-stage");return void getResults([l,n,!1],!1,!0)}$("#main").html(t.context),titleUpdater()}}).on("blur",function(){window.clearInterval(charts),window.clearInterval(last_played)}).on("focus",function(){lastPlayedUpdater(),chartsUpdater()}).on("resize",function(){hoverDisabler()});
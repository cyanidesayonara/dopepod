{% extends request.is_ajax|yesno:'ajax.html,index/header.html' %}

{% block title %}
{{ podcast.title }}
{% endblock %}

{% block content %}
<!-- PODINFO BAR -->
<div class="container" id="podinfo">
  <div class="row" id="podinfo-bar">
    <div class="col-auto texture">
      <img src="{{ podcast.artworkUrl }}170x170bb.jpg" />
    </div>
    <div class="col texture">
      <h3>
        {{ podcast.title }}
      </h3>
      <p>
        {{ podcast.description }}<
        /p>
    </div>
    <div class="col-auto texture">
      {% if podcast.subscribed %}
        <form class="sub-form" action="{% url 'subscribe' %}"
        id="{{ podcast.itunesid }}" method="POST">
          {% csrf_token %}
          <input type="hidden" name="itunesid" value="{{ podcast.itunesid }}">
          <input type="submit" class="btn btn-outline-primary" id="sub-button"
          value="Unsubscribe">
        </form>
      {% else %}
        <form class="sub-form" action="{% url 'subscribe' %}"
        id="{{ podcast.itunesid }}" method="POST">
          {% csrf_token %}
          <input type="hidden" name="itunesid" value="{{ podcast.itunesid }}">
          <input type="submit" class="btn btn-outline-primary" id="sub-button"
          value="Subscribe">
        </form>
      {% endif %}
      <p>
        {% if podcast.genre.supa %}
          {{ podcast.genre.supa }} -
        {% endif %}
        {{ podcast.genre }}
      </p>
      <p>
        {{ podcast.language }}
      </p>
      {% if podcast.explicit %}
        <p>
          Explicit
        </p>
      {% endif %}
      <p>
        <em>
          {{ podcast.copyrighttext }}
        </em>
      </p>
    </div>
  </div>
</div>
<!-- TRACKS -->
<div class="container">
  <div class="row" id="tracks">
    {% include 'tracks.html' %}
  </div>
</div>
{% endblock %}

{% block extrajs %}
<script>
$(window).ready(function() {
  // load tracks for podcast
  // TODO also load on back button
  var url = "/tracks/";
  var itunesid = "{{ podcast.itunesid }}";
  $.ajax({
    method: "POST",
    url: url,
    data: {
      "itunesid": itunesid,
    },
  })
    .fail(function(xhr, ajaxOptions, thrownError){
      console.log(thrownError);
    })
    .done(function(response) {
      // $("#tracks").html(response);
      // $('#overlay').hide();
    });
});
</script>
{% endblock %}

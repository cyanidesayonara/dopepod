{% extends request.is_ajax|yesno:'ajax.html,base.html' %}

{% block title %}
Listen to episodes of {{ podcast.title }} on dopepod
{% endblock %}

{% block center-stage %}
<div class="col-12 results color-5-trans showpod">
  <div class="row" id="showpod">
    <div class="col-12 col-lg-4" id="showpod-l">
      <img class="img-fluid" src="https://dopepod.me/img/{{ podcast.artworkUrl }}380x380bb.jpg"
      onerror="this.src='http://{{ podcast.artworkUrl }}380x380bb.jpg'" />
    </div>
    <div class="col-12 col-lg-5" id="showpod-c" data-podid="{{ podcast.podid }}">
      <h1>
        <strong>
          {{ podcast.title }}
        </strong>
      </h1>
      <h2>
        By
        <strong>
          {{ podcast.artist }}
        </strong>
      </h2>
      <p>
        {{ podcast.description }}
      </p>
    </div>
    <div class="col-12 col-lg-3" id="showpod-r">
      <ul class="showpod-side-list">
        {% if podcast.rank %}
          <li>
            #{{ podcast.rank }} in
            <a class="browse-link" href="/search/">
              Podcasts
            </a>
          </li>
        {% endif %}
        {% if podcast.genre_rank %}
          <li>
            #{{ podcast.genre_rank }} in
            <a class="browse-link" href="/search/?genre={{ podcast.get_primary_genre.url_format }}">
              {{ podcast.get_primary_genre }}
            </a>
          </li>
        {% endif %}
        {% if podcast.language_rank %}
          <li>
            #{{ podcast.language_rank }} in
            <a class="browse-link" href="/search/?language={{ podcast.language.url_format }}">
              {{ podcast.language }}
            </a>
          </li>
        {% endif %}
        <li>
          {{ podcast.get_n_subscribers }} subscribers
        </li>
        <li>
          Content:
          {% if podcast.explicit %}
            explicit
          {% else %}
            clean
          {% endif %}
        </li>
        <li>
          <a class="showpod-podcastUrl" href="{{ podcast.podcastUrl }}">
            Podcast website
          </a>
        </li>
        <li>
          <a class="showpod-feedUrl" href="{{ podcast.feedUrl }}">
            Podcast RSS feed
          </a>
        </li>
        <li>
          <em>
            {{ podcast.copyrighttext }}
          </em>
        </li>
      </ul>
    </div>
    <div class="col-12 showpod-buttons">
      <button class="btn-dope showpod-back" onclick="window.history.back()">
        <i class="fas fa-arrow-circle-left"></i>
      </button>
      {% if user.is_authenticated %}
        <form class="d-inline sub-form" action="{% url 'subscribe' %}" method="POST">
          {% csrf_token %}
          <input type="hidden" name="podid" value="{{ podcast.podid }}">
          {% if podcast.is_subscribed %}
            <button type="submit" class="btn-dope sub-button">
              Unsubscribe
            </button>
          {% else %}
            <button type="submit" class="btn-dope active sub-button">
              Subscribe
            </button>
          {% endif %}
        </form>
      {% endif %}
      <a class="btn-dope episodes-button toggle" data-toggle="collapse" href="#episodes-collapse" aria-expanded="true" aria-controls="episodes-collapse">
        {% if request.is_ajax %}
          {% include 'button_loading.html' %}
        {% else %}
          Episodes
        {% endif %}
      </a>
      <a class="btn-dope reviews-button toggle" data-toggle="collapse" href="#reviews-collapse" aria-expanded="false" aria-controls="reviews-collapse">
        Reviews
      </a>
    </div>
    <div class="col-12 showpod-collapse collapse show" id="episodes-collapse">
      {% if results.episodes %}
        {% include 'episodes.html' %}
      {% endif%}
    </div>
    <div class="col-12 showpod-collapse collapse" id="reviews-collapse">
      <p>
        Coming soon
      </p>
    </div>
  </div>
</div>
{% endblock %}

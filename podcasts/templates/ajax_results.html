{% if podcasts %}
{% for podcast in podcasts %}
<div class="col-lg-2 col-md-3 col-sm-4 result-box">
  <div class="row">
    <a class="col result-image show-podinfo" id="{{ podcast.itunesid }}" href=
     "{% url 'podinfo' itunesid=podcast.itunesid %}">
      <img src="{{ podcast.artworkUrl }}156x156bb.jpg" />
      <div class="col">
        <div class="row result-title">
          <h6>{{ podcast.title }}</h6>
        </div>
        <div class="row result-genre">
          <p>{% if podcast.genre.supa %}{{ podcast.genre.supa }} - {% endif %}{{ podcast.genre }}</p>
        </div>
      </div>
    </a>
  </div>
</div>
{% endfor %}

<script>
$(function() {
  $('.show-podinfo').click(function(event) {
    event.preventDefault();
    var itunesid = this.id;
    var ajax_url = "{% url 'ajax_podinfo' %}";
    var url = ajax_url + itunesid + "/";
    var csrftoken = "{{ csrf_token }}";
    $.ajax({
      type: "POST",
      url: ajax_url,
      data: {
        "itunesid": itunesid,
        "csrfmiddlewaretoken": csrftoken,
      },
      error: function(xhr, ajaxOptions, thrownError) {
        console.log(thrownError);
      },
      success: function(response) {
        // save results + q in current state
        var curContext = $(".site-content")[0].innerHTML;
        q = $("#q").val();
        var curUrl = $(".site-content")[0].baseURI;
        var curTitle = "dopepod";
        var curState = {
          "context": curContext,
          "title": curTitle,
          "q": q
        };
        history.replaceState(curState, "", curUrl);

        //push new state
        var title = "podinfo";
        var state = {
          "context": response,
          "title": title,
        };
        history.pushState(state, "", url);
        $(".site-content").html(response);
        $("title")[0].innerText = title;
      }
    });
  });
});
</script>
{% endif %}
